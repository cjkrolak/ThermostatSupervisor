<!DOCTYPE html>

<html lang="en" data-content_root="../../">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>thermostatsupervisor.thermostat_common &#8212; ThermostatSupervisor  documentation</title>
    <link rel="stylesheet" type="text/css" href="../../_static/pygments.css?v=d1102ebc" />
    <link rel="stylesheet" type="text/css" href="../../_static/basic.css?v=686e5160" />
    <link rel="stylesheet" type="text/css" href="../../_static/alabaster.css?v=27fed22d" />
    <script src="../../_static/documentation_options.js?v=5929fcd5"></script>
    <script src="../../_static/doctools.js?v=9bcbadda"></script>
    <script src="../../_static/sphinx_highlight.js?v=dc90522c"></script>
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" />
   
  <link rel="stylesheet" href="../../_static/custom.css" type="text/css" />
  

  
  

  </head><body>
  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          

          <div class="body" role="main">
            
  <h1>Source code for thermostatsupervisor.thermostat_common</h1><div class="highlight"><pre>
<span></span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">Common Thermostat Class</span>
<span class="sd">&quot;&quot;&quot;</span>
<span class="c1"># built-ins</span>
<span class="kn">import</span> <span class="nn">datetime</span>
<span class="kn">import</span> <span class="nn">operator</span>
<span class="kn">import</span> <span class="nn">pprint</span>
<span class="kn">import</span> <span class="nn">statistics</span>
<span class="kn">import</span> <span class="nn">time</span>
<span class="kn">import</span> <span class="nn">traceback</span>

<span class="c1"># local imports</span>
<span class="kn">from</span> <span class="nn">thermostatsupervisor</span> <span class="kn">import</span> <span class="n">email_notification</span> <span class="k">as</span> <span class="n">eml</span>
<span class="kn">from</span> <span class="nn">thermostatsupervisor</span> <span class="kn">import</span> <span class="n">thermostat_api</span> <span class="k">as</span> <span class="n">api</span>
<span class="kn">from</span> <span class="nn">thermostatsupervisor</span> <span class="kn">import</span> <span class="n">utilities</span> <span class="k">as</span> <span class="n">util</span>


<span class="n">DEGREE_SIGN</span> <span class="o">=</span> <span class="s2">&quot;</span><span class="se">\N{DEGREE SIGN}</span><span class="s2">&quot;</span>

<span class="n">connection_ok</span> <span class="o">=</span> <span class="kc">True</span>  <span class="c1"># global flag for connection OK.</span>


<div class="viewcode-block" id="ThermostatCommon">
<a class="viewcode-back" href="../../docs/thermostatsupervisor.html#thermostatsupervisor.thermostat_common.ThermostatCommon">[docs]</a>
<span class="k">class</span> <span class="nc">ThermostatCommon</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Class methods common to all thermostat objects.&quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">_</span><span class="p">,</span> <span class="o">**</span><span class="n">__</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">verbose</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">thermostat_type</span> <span class="o">=</span> <span class="s2">&quot;unknown&quot;</span>  <span class="c1"># placeholder</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">zone_number</span> <span class="o">=</span> <span class="n">util</span><span class="o">.</span><span class="n">BOGUS_INT</span>  <span class="c1"># placeholder</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">device_id</span> <span class="o">=</span> <span class="n">util</span><span class="o">.</span><span class="n">BOGUS_INT</span>  <span class="c1"># placeholder</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ip_address</span> <span class="o">=</span> <span class="kc">None</span>  <span class="c1"># placeholder</span>
        <span class="k">global</span> <span class="n">connection_ok</span>  <span class="c1"># noqa W603</span>
        <span class="n">connection_ok</span> <span class="o">=</span> <span class="kc">True</span>

<div class="viewcode-block" id="ThermostatCommon.get_all_metadata">
<a class="viewcode-back" href="../../docs/thermostatsupervisor.html#thermostatsupervisor.thermostat_common.ThermostatCommon.get_all_metadata">[docs]</a>
    <span class="k">def</span> <span class="nf">get_all_metadata</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">zone</span><span class="p">,</span> <span class="n">retry</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Get all the current thermostat metadata.</span>

<span class="sd">        inputs:</span>
<span class="sd">            zone(int): target zone</span>
<span class="sd">            retry(bool): if True will retry once.</span>
<span class="sd">        returns:</span>
<span class="sd">            (dict) results dict.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">raise</span> <span class="ne">NotImplementedError</span><span class="p">(</span>
            <span class="s2">&quot;get_all_metadata is not implemented for this thermostat type&quot;</span>
        <span class="p">)</span></div>


<div class="viewcode-block" id="ThermostatCommon.get_metadata">
<a class="viewcode-back" href="../../docs/thermostatsupervisor.html#thermostatsupervisor.thermostat_common.ThermostatCommon.get_metadata">[docs]</a>
    <span class="k">def</span> <span class="nf">get_metadata</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">zone</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">trait</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">parameter</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Get thermostat meta data for zone.</span>

<span class="sd">        inputs:</span>
<span class="sd">            zone(str or int): specified zone</span>
<span class="sd">            trait(str): trait or parent key, if None will assume a non-nested</span>
<span class="sd">                        dict.</span>
<span class="sd">            parameter(str): target parameter, if None will return all.</span>
<span class="sd">        returns:</span>
<span class="sd">            (dict): dictionary of meta data.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">raise</span> <span class="ne">NotImplementedError</span><span class="p">(</span>
            <span class="s2">&quot;get_metadata is not implemented for this&quot;</span> <span class="s2">&quot;thermostat type&quot;</span>
        <span class="p">)</span></div>


<div class="viewcode-block" id="ThermostatCommon.print_all_thermostat_metadata">
<a class="viewcode-back" href="../../docs/thermostatsupervisor.html#thermostatsupervisor.thermostat_common.ThermostatCommon.print_all_thermostat_metadata">[docs]</a>
    <span class="k">def</span> <span class="nf">print_all_thermostat_metadata</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">zone</span><span class="p">):</span>  <span class="c1"># noqa R0201</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Print initial meta data queried from thermostat for specified zone.</span>

<span class="sd">        inputs:</span>
<span class="sd">            zone(int): zone number</span>
<span class="sd">        returns:</span>
<span class="sd">            None</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">util</span><span class="o">.</span><span class="n">log_msg</span><span class="p">(</span>
            <span class="sa">f</span><span class="s2">&quot;WARNING: print_all_thermostat_metatdata(</span><span class="si">{</span><span class="n">zone</span><span class="si">}</span><span class="s2">) not yet &quot;</span>
            <span class="sa">f</span><span class="s2">&quot;implemented for this thermostat type</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">,</span>
            <span class="n">mode</span><span class="o">=</span><span class="n">util</span><span class="o">.</span><span class="n">BOTH_LOG</span><span class="p">,</span>
            <span class="n">func_name</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
        <span class="p">)</span></div>


<div class="viewcode-block" id="ThermostatCommon.exec_print_all_thermostat_metadata">
<a class="viewcode-back" href="../../docs/thermostatsupervisor.html#thermostatsupervisor.thermostat_common.ThermostatCommon.exec_print_all_thermostat_metadata">[docs]</a>
    <span class="k">def</span> <span class="nf">exec_print_all_thermostat_metadata</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">func</span><span class="p">,</span> <span class="n">args</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Print all metadata to screen.</span>

<span class="sd">        inputs:</span>
<span class="sd">            func(obj): function get metadata.</span>
<span class="sd">            args(list): argument list</span>
<span class="sd">        returns:</span>
<span class="sd">            (dict): return data</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># dump metadata in a readable format</span>
        <span class="n">return_data</span> <span class="o">=</span> <span class="n">func</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">)</span>
        <span class="n">pprint_obj</span> <span class="o">=</span> <span class="n">pprint</span><span class="o">.</span><span class="n">PrettyPrinter</span><span class="p">(</span><span class="n">indent</span><span class="o">=</span><span class="mi">4</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="n">util</span><span class="o">.</span><span class="n">log_msg</span><span class="p">(</span><span class="s2">&quot;raw thermostat meta data:&quot;</span><span class="p">,</span> <span class="n">mode</span><span class="o">=</span><span class="n">util</span><span class="o">.</span><span class="n">BOTH_LOG</span><span class="p">,</span> <span class="n">func_name</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
        <span class="n">pprint_obj</span><span class="o">.</span><span class="n">pprint</span><span class="p">(</span><span class="n">return_data</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">return_data</span></div>
</div>



<div class="viewcode-block" id="ThermostatCommonZone">
<a class="viewcode-back" href="../../docs/thermostatsupervisor.html#thermostatsupervisor.thermostat_common.ThermostatCommonZone">[docs]</a>
<span class="k">class</span> <span class="nc">ThermostatCommonZone</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Class methods common to all thermostat zones.&quot;&quot;&quot;</span>

    <span class="c1"># supported thermostat modes and label text</span>
    <span class="n">OFF_MODE</span> <span class="o">=</span> <span class="s2">&quot;OFF_MODE&quot;</span>
    <span class="n">HEAT_MODE</span> <span class="o">=</span> <span class="s2">&quot;HEAT_MODE&quot;</span>
    <span class="n">COOL_MODE</span> <span class="o">=</span> <span class="s2">&quot;COOL_MODE&quot;</span>
    <span class="n">AUTO_MODE</span> <span class="o">=</span> <span class="s2">&quot;AUTO_MODE&quot;</span>
    <span class="n">DRY_MODE</span> <span class="o">=</span> <span class="s2">&quot;DRY_MODE&quot;</span>
    <span class="n">FAN_MODE</span> <span class="o">=</span> <span class="s2">&quot;FAN_MODE&quot;</span>
    <span class="n">UNKNOWN_MODE</span> <span class="o">=</span> <span class="s2">&quot;UNKNOWN_MODE&quot;</span>  <span class="c1"># bypass set mode or unable to detect</span>

    <span class="c1"># modes where heat is applied</span>
    <span class="n">heat_modes</span> <span class="o">=</span> <span class="p">[</span><span class="n">HEAT_MODE</span><span class="p">,</span> <span class="n">AUTO_MODE</span><span class="p">]</span>

    <span class="c1"># modes where cooling is applied</span>
    <span class="n">cool_modes</span> <span class="o">=</span> <span class="p">[</span><span class="n">COOL_MODE</span><span class="p">,</span> <span class="n">DRY_MODE</span><span class="p">,</span> <span class="n">AUTO_MODE</span><span class="p">]</span>

    <span class="c1"># modes in which setpoints apply</span>
    <span class="n">controlled_modes</span> <span class="o">=</span> <span class="p">[</span><span class="n">HEAT_MODE</span><span class="p">,</span> <span class="n">AUTO_MODE</span><span class="p">,</span> <span class="n">COOL_MODE</span><span class="p">]</span>

    <span class="n">system_switch_position</span> <span class="o">=</span> <span class="p">{</span>
        <span class="c1"># placeholder, will be tstat-specific</span>
        <span class="n">UNKNOWN_MODE</span><span class="p">:</span> <span class="n">util</span><span class="o">.</span><span class="n">BOGUS_INT</span><span class="p">,</span>
        <span class="n">HEAT_MODE</span><span class="p">:</span> <span class="n">util</span><span class="o">.</span><span class="n">BOGUS_INT</span> <span class="o">-</span> <span class="mi">1</span><span class="p">,</span>
        <span class="n">COOL_MODE</span><span class="p">:</span> <span class="n">util</span><span class="o">.</span><span class="n">BOGUS_INT</span> <span class="o">-</span> <span class="mi">2</span><span class="p">,</span>
        <span class="n">AUTO_MODE</span><span class="p">:</span> <span class="n">util</span><span class="o">.</span><span class="n">BOGUS_INT</span> <span class="o">-</span> <span class="mi">3</span><span class="p">,</span>
        <span class="n">DRY_MODE</span><span class="p">:</span> <span class="n">util</span><span class="o">.</span><span class="n">BOGUS_INT</span> <span class="o">-</span> <span class="mi">4</span><span class="p">,</span>
        <span class="n">FAN_MODE</span><span class="p">:</span> <span class="n">util</span><span class="o">.</span><span class="n">BOGUS_INT</span> <span class="o">-</span> <span class="mi">5</span><span class="p">,</span>
        <span class="n">OFF_MODE</span><span class="p">:</span> <span class="n">util</span><span class="o">.</span><span class="n">BOGUS_INT</span> <span class="o">-</span> <span class="mi">6</span><span class="p">,</span>
    <span class="p">}</span>
    <span class="n">max_scheduled_heat_allowed</span> <span class="o">=</span> <span class="mi">74</span>  <span class="c1"># warn if scheduled heat value exceeds.</span>
    <span class="n">min_scheduled_cool_allowed</span> <span class="o">=</span> <span class="mi">68</span>  <span class="c1"># warn if scheduled cool value exceeds.</span>
    <span class="n">tolerance_degrees_default</span> <span class="o">=</span> <span class="mi">2</span>  <span class="c1"># allowed override vs. the scheduled value.</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">_</span><span class="p">,</span> <span class="o">**</span><span class="n">__</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">verbose</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">thermostat_type</span> <span class="o">=</span> <span class="s2">&quot;unknown&quot;</span>  <span class="c1"># placeholder</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">zone_number</span> <span class="o">=</span> <span class="n">util</span><span class="o">.</span><span class="n">BOGUS_INT</span>  <span class="c1"># placeholder</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">zone_name</span> <span class="o">=</span> <span class="kc">None</span>  <span class="c1"># placeholder</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">device_id</span> <span class="o">=</span> <span class="n">util</span><span class="o">.</span><span class="n">BOGUS_INT</span>  <span class="c1"># placeholder</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">poll_time_sec</span> <span class="o">=</span> <span class="n">util</span><span class="o">.</span><span class="n">BOGUS_INT</span>  <span class="c1"># placeholder</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">session_start_time_sec</span> <span class="o">=</span> <span class="n">util</span><span class="o">.</span><span class="n">BOGUS_INT</span>  <span class="c1"># placeholder</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">connection_time_sec</span> <span class="o">=</span> <span class="n">util</span><span class="o">.</span><span class="n">BOGUS_INT</span>  <span class="c1"># placeholder</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">target_mode</span> <span class="o">=</span> <span class="s2">&quot;OFF_MODE&quot;</span>  <span class="c1"># placeholder</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">flag_all_deviations</span> <span class="o">=</span> <span class="kc">False</span>  <span class="c1">#</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">revert_deviations</span> <span class="o">=</span> <span class="kc">True</span>  <span class="c1"># Revert deviation</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">revert_all_deviations</span> <span class="o">=</span> <span class="kc">False</span>  <span class="c1"># Revert only energy-wasting events</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">temperature_is_deviated</span> <span class="o">=</span> <span class="kc">False</span>  <span class="c1"># temp deviated from schedule</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">display_temp</span> <span class="o">=</span> <span class="kc">None</span>  <span class="c1"># current temperature in °F</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">display_humidity</span> <span class="o">=</span> <span class="kc">None</span>  <span class="c1"># current humidity in %RH</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">humidity_is_available</span> <span class="o">=</span> <span class="kc">False</span>  <span class="c1"># humidity supported flag</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">hold_mode</span> <span class="o">=</span> <span class="kc">False</span>  <span class="c1"># True = not following schedule</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">hold_temporary</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">zone_info</span> <span class="o">=</span> <span class="p">{}</span>  <span class="c1"># dict containing zone data</span>

        <span class="c1"># server data cache expiration parameters</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">fetch_interval_sec</span> <span class="o">=</span> <span class="mi">10</span>  <span class="c1"># age of server data before refresh</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">last_fetch_time</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span> <span class="o">-</span> <span class="mi">2</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">fetch_interval_sec</span>

        <span class="c1"># abstraction vars and funcs, defined in query_thermostat_zone</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">current_mode</span> <span class="o">=</span> <span class="kc">None</span>  <span class="c1"># str representing mode</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">current_setpoint</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">util</span><span class="o">.</span><span class="n">BOGUS_INT</span><span class="p">)</span>  <span class="c1"># current setpoint</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">schedule_setpoint</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">util</span><span class="o">.</span><span class="n">BOGUS_INT</span><span class="p">)</span>  <span class="c1"># current scheduled setpoint</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">tolerance_sign</span> <span class="o">=</span> <span class="mi">1</span>  <span class="c1"># +1 for heat, -1 for cool</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">operator</span> <span class="o">=</span> <span class="n">operator</span><span class="o">.</span><span class="n">ne</span>  <span class="c1"># operator for deviation check</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">tolerance_degrees</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">tolerance_degrees_default</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">global_limit</span> <span class="o">=</span> <span class="n">util</span><span class="o">.</span><span class="n">BOGUS_INT</span>  <span class="c1"># global temp limit</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">global_operator</span> <span class="o">=</span> <span class="n">operator</span><span class="o">.</span><span class="n">ne</span>  <span class="c1"># oper for global temp deviation</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">revert_setpoint_func</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">function_not_supported</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">get_setpoint_func</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">function_not_supported</span>

<div class="viewcode-block" id="ThermostatCommonZone.query_thermostat_zone">
<a class="viewcode-back" href="../../docs/thermostatsupervisor.html#thermostatsupervisor.thermostat_common.ThermostatCommonZone.query_thermostat_zone">[docs]</a>
    <span class="k">def</span> <span class="nf">query_thermostat_zone</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Return the current mode and set mode-specific parameters.&quot;&quot;&quot;</span>

        <span class="c1"># current temperature</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">display_temp</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">validate_numeric</span><span class="p">(</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">get_display_temp</span><span class="p">(),</span> <span class="s2">&quot;get_display_temp&quot;</span>
            <span class="p">)</span>
        <span class="k">except</span> <span class="ne">TypeError</span><span class="p">:</span>
            <span class="n">util</span><span class="o">.</span><span class="n">log_msg</span><span class="p">(</span><span class="n">traceback</span><span class="o">.</span><span class="n">format_exc</span><span class="p">(),</span> <span class="n">mode</span><span class="o">=</span><span class="n">util</span><span class="o">.</span><span class="n">BOTH_LOG</span><span class="p">,</span> <span class="n">func_name</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">display_temp</span> <span class="o">=</span> <span class="kc">None</span>

        <span class="c1"># current humidity</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">display_humidity</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_display_humidity</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">humidity_is_available</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_is_humidity_supported</span><span class="p">()</span>

        <span class="c1"># mode-specific parameters</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">is_heat_mode</span><span class="p">():</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">current_mode</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">HEAT_MODE</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">current_setpoint</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">get_heat_setpoint_raw</span><span class="p">())</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">schedule_setpoint</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">get_schedule_heat_sp</span><span class="p">())</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">tolerance_sign</span> <span class="o">=</span> <span class="mi">1</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">flag_all_deviations</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">operator</span> <span class="o">=</span> <span class="n">operator</span><span class="o">.</span><span class="n">ne</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">tolerance_degrees</span> <span class="o">=</span> <span class="mi">0</span>  <span class="c1"># disable tolerance</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">operator</span> <span class="o">=</span> <span class="n">operator</span><span class="o">.</span><span class="n">gt</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">global_limit</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">max_scheduled_heat_allowed</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">global_operator</span> <span class="o">=</span> <span class="n">operator</span><span class="o">.</span><span class="n">gt</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">revert_setpoint_func</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">set_heat_setpoint</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">get_setpoint_func</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_heat_setpoint_raw</span>
        <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">is_cool_mode</span><span class="p">():</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">current_mode</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">COOL_MODE</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">current_setpoint</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">get_cool_setpoint_raw</span><span class="p">())</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">schedule_setpoint</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">get_schedule_cool_sp</span><span class="p">())</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">tolerance_sign</span> <span class="o">=</span> <span class="o">-</span><span class="mi">1</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">flag_all_deviations</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">operator</span> <span class="o">=</span> <span class="n">operator</span><span class="o">.</span><span class="n">ne</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">tolerance_degrees</span> <span class="o">=</span> <span class="mi">0</span>  <span class="c1"># disable tolerance</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">operator</span> <span class="o">=</span> <span class="n">operator</span><span class="o">.</span><span class="n">lt</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">global_limit</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">min_scheduled_cool_allowed</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">global_operator</span> <span class="o">=</span> <span class="n">operator</span><span class="o">.</span><span class="n">lt</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">revert_setpoint_func</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">set_cool_setpoint</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">get_setpoint_func</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_cool_setpoint_raw</span>
        <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">is_dry_mode</span><span class="p">():</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">current_mode</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">DRY_MODE</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">current_setpoint</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">get_cool_setpoint_raw</span><span class="p">())</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">schedule_setpoint</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">get_schedule_cool_sp</span><span class="p">())</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">tolerance_sign</span> <span class="o">=</span> <span class="o">-</span><span class="mi">1</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">flag_all_deviations</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">operator</span> <span class="o">=</span> <span class="n">operator</span><span class="o">.</span><span class="n">ne</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">tolerance_degrees</span> <span class="o">=</span> <span class="mi">0</span>  <span class="c1"># disable tolerance</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">operator</span> <span class="o">=</span> <span class="n">operator</span><span class="o">.</span><span class="n">lt</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">global_limit</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">min_scheduled_cool_allowed</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">global_operator</span> <span class="o">=</span> <span class="n">operator</span><span class="o">.</span><span class="n">lt</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">revert_setpoint_func</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">function_not_supported</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">get_setpoint_func</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">function_not_supported</span>
        <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">is_auto_mode</span><span class="p">():</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">current_mode</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">AUTO_MODE</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">current_setpoint</span> <span class="o">=</span> <span class="n">util</span><span class="o">.</span><span class="n">BOGUS_INT</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">schedule_setpoint</span> <span class="o">=</span> <span class="n">util</span><span class="o">.</span><span class="n">BOGUS_INT</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">tolerance_sign</span> <span class="o">=</span> <span class="mi">1</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">operator</span> <span class="o">=</span> <span class="n">operator</span><span class="o">.</span><span class="n">ne</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">global_limit</span> <span class="o">=</span> <span class="n">util</span><span class="o">.</span><span class="n">BOGUS_INT</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">global_operator</span> <span class="o">=</span> <span class="n">operator</span><span class="o">.</span><span class="n">ne</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">revert_setpoint_func</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">function_not_supported</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">get_setpoint_func</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">function_not_supported</span>
        <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">is_fan_mode</span><span class="p">():</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">current_mode</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">FAN_MODE</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">current_setpoint</span> <span class="o">=</span> <span class="n">util</span><span class="o">.</span><span class="n">BOGUS_INT</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">schedule_setpoint</span> <span class="o">=</span> <span class="n">util</span><span class="o">.</span><span class="n">BOGUS_INT</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">tolerance_sign</span> <span class="o">=</span> <span class="mi">1</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">operator</span> <span class="o">=</span> <span class="n">operator</span><span class="o">.</span><span class="n">ne</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">global_limit</span> <span class="o">=</span> <span class="n">util</span><span class="o">.</span><span class="n">BOGUS_INT</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">global_operator</span> <span class="o">=</span> <span class="n">operator</span><span class="o">.</span><span class="n">ne</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">revert_setpoint_func</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">function_not_supported</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">get_setpoint_func</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">function_not_supported</span>
        <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">is_off_mode</span><span class="p">():</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">current_mode</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">OFF_MODE</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">current_setpoint</span> <span class="o">=</span> <span class="n">util</span><span class="o">.</span><span class="n">BOGUS_INT</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">schedule_setpoint</span> <span class="o">=</span> <span class="n">util</span><span class="o">.</span><span class="n">BOGUS_INT</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">tolerance_sign</span> <span class="o">=</span> <span class="mi">1</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">operator</span> <span class="o">=</span> <span class="n">operator</span><span class="o">.</span><span class="n">ne</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">global_limit</span> <span class="o">=</span> <span class="n">util</span><span class="o">.</span><span class="n">BOGUS_INT</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">global_operator</span> <span class="o">=</span> <span class="n">operator</span><span class="o">.</span><span class="n">ne</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">revert_setpoint_func</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">function_not_supported</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">get_setpoint_func</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">function_not_supported</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;DEBUG: zone info: </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">zone_info</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;unknown thermostat mode&quot;</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">temperature_is_deviated</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">is_temp_deviated_from_schedule</span><span class="p">()</span></div>


<div class="viewcode-block" id="ThermostatCommonZone.is_temp_deviated_from_schedule">
<a class="viewcode-back" href="../../docs/thermostatsupervisor.html#thermostatsupervisor.thermostat_common.ThermostatCommonZone.is_temp_deviated_from_schedule">[docs]</a>
    <span class="k">def</span> <span class="nf">is_temp_deviated_from_schedule</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Return True if temperature is deviated from current schedule.</span>

<span class="sd">        inputs:</span>
<span class="sd">            None:</span>
<span class="sd">        returns:</span>
<span class="sd">            (bool): True if temp is deviated from schedule.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">operator</span><span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">current_setpoint</span><span class="p">,</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">schedule_setpoint</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">tolerance_sign</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">tolerance_degrees</span><span class="p">,</span>
        <span class="p">)</span></div>


<div class="viewcode-block" id="ThermostatCommonZone.get_current_mode">
<a class="viewcode-back" href="../../docs/thermostatsupervisor.html#thermostatsupervisor.thermostat_common.ThermostatCommonZone.get_current_mode">[docs]</a>
    <span class="k">def</span> <span class="nf">get_current_mode</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span> <span class="n">session_count</span><span class="p">,</span> <span class="n">poll_count</span><span class="p">,</span> <span class="n">print_status</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">flag_all_deviations</span><span class="o">=</span><span class="kc">False</span>
    <span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Determine whether thermostat is following schedule or if it has been</span>
<span class="sd">        deviated from schedule.</span>

<span class="sd">        inputs:</span>
<span class="sd">            session_count(int): session number (connection #) for reporting</span>
<span class="sd">            poll_count(int): poll number for reporting</span>
<span class="sd">            print_status(bool):  True to print status line</span>
<span class="sd">            flag_all_deviations(bool):  True: flag all deviations</span>
<span class="sd">                                        False(default): only flag energy</span>
<span class="sd">                                                        consuming deviations,</span>
<span class="sd">                                                        e.g. heat setpoint</span>
<span class="sd">                                                        above schedule,</span>
<span class="sd">                                                        cool setpoint</span>
<span class="sd">                                                        below schedule</span>
<span class="sd">        returns:</span>
<span class="sd">            dictionary of heat/cool mode status, deviation status,</span>
<span class="sd">            and hold status</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">return_buffer</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s2">&quot;heat_mode&quot;</span><span class="p">:</span> <span class="n">util</span><span class="o">.</span><span class="n">BOGUS_BOOL</span><span class="p">,</span>  <span class="c1"># in heating mode</span>
            <span class="s2">&quot;cool_mode&quot;</span><span class="p">:</span> <span class="n">util</span><span class="o">.</span><span class="n">BOGUS_BOOL</span><span class="p">,</span>  <span class="c1"># in cooling mode</span>
            <span class="s2">&quot;heat_deviation&quot;</span><span class="p">:</span> <span class="n">util</span><span class="o">.</span><span class="n">BOGUS_BOOL</span><span class="p">,</span>  <span class="c1"># True: heat is deviated above</span>
            <span class="s2">&quot;cool_deviation&quot;</span><span class="p">:</span> <span class="n">util</span><span class="o">.</span><span class="n">BOGUS_BOOL</span><span class="p">,</span>  <span class="c1"># True: cool is deviated below</span>
            <span class="s2">&quot;hold_mode&quot;</span><span class="p">:</span> <span class="n">util</span><span class="o">.</span><span class="n">BOGUS_BOOL</span><span class="p">,</span>  <span class="c1"># True if hold is enabled</span>
            <span class="s2">&quot;status_msg&quot;</span><span class="p">:</span> <span class="s2">&quot;&quot;</span><span class="p">,</span>  <span class="c1"># status message</span>
        <span class="p">}</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">flag_all_deviations</span> <span class="o">=</span> <span class="n">flag_all_deviations</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">query_thermostat_zone</span><span class="p">()</span>

        <span class="c1"># warning email if set point is outside global limit</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">warn_if_outside_global_limit</span><span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">current_setpoint</span><span class="p">,</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">global_limit</span><span class="p">,</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">global_operator</span><span class="p">,</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">current_mode</span><span class="p">,</span>
        <span class="p">)</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">is_temp_deviated_from_schedule</span><span class="p">()</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">is_controlled_mode</span><span class="p">():</span>
            <span class="n">status_msg</span> <span class="o">=</span> <span class="p">(</span>
                <span class="sa">f</span><span class="s2">&quot;[</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">current_mode</span><span class="o">.</span><span class="n">upper</span><span class="p">()</span><span class="si">}</span><span class="s2"> deviation] act temp=&quot;</span>
                <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">util</span><span class="o">.</span><span class="n">temp_value_with_units</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">display_temp</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span>
            <span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">status_msg</span> <span class="o">=</span> <span class="p">(</span>
                <span class="sa">f</span><span class="s2">&quot;[following schedule] act temp=&quot;</span>
                <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">util</span><span class="o">.</span><span class="n">temp_value_with_units</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">display_temp</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span>
            <span class="p">)</span>

        <span class="c1"># add humidity if available</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">humidity_is_available</span><span class="p">:</span>
            <span class="n">status_msg</span> <span class="o">+=</span> <span class="p">(</span>
                <span class="sa">f</span><span class="s2">&quot;, act humidity=&quot;</span>
                <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">util</span><span class="o">.</span><span class="n">humidity_value_with_units</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">display_humidity</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span>
            <span class="p">)</span>

        <span class="c1"># add hold information</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">is_temp_deviated_from_schedule</span><span class="p">()</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">is_controlled_mode</span><span class="p">():</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">hold_mode</span> <span class="o">=</span> <span class="kc">True</span>  <span class="c1"># True = not following schedule</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">hold_temporary</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_temporary_hold_until_time</span><span class="p">()</span> <span class="o">&gt;</span> <span class="mi">0</span>
            <span class="n">status_msg</span> <span class="o">+=</span> <span class="sa">f</span><span class="s2">&quot; (</span><span class="si">{</span><span class="p">[</span><span class="s1">&#39;persistent&#39;</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;temporary&#39;</span><span class="p">][</span><span class="bp">self</span><span class="o">.</span><span class="n">hold_temporary</span><span class="p">]</span><span class="si">}</span><span class="s2">)&quot;</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">hold_mode</span> <span class="o">=</span> <span class="kc">False</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">hold_temporary</span> <span class="o">=</span> <span class="kc">False</span>

        <span class="c1"># add setpoints if in heat or cool mode</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">is_heat_mode</span><span class="p">()</span> <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">is_cool_mode</span><span class="p">():</span>
            <span class="n">status_msg</span> <span class="o">+=</span> <span class="p">(</span>
                <span class="sa">f</span><span class="s2">&quot;, set point=&quot;</span>
                <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">util</span><span class="o">.</span><span class="n">temp_value_with_units</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">schedule_setpoint</span><span class="p">)</span><span class="si">}</span><span class="s2">, &quot;</span>
                <span class="sa">f</span><span class="s2">&quot;tolerance=&quot;</span>
                <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">util</span><span class="o">.</span><span class="n">temp_value_with_units</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">tolerance_degrees</span><span class="p">,</span><span class="w"> </span><span class="n">precision</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span><span class="si">}</span><span class="s2">, &quot;</span>
                <span class="sa">f</span><span class="s2">&quot;override=&quot;</span>
                <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">util</span><span class="o">.</span><span class="n">temp_value_with_units</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">current_setpoint</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span>
            <span class="p">)</span>

        <span class="n">date_str</span> <span class="o">=</span> <span class="n">datetime</span><span class="o">.</span><span class="n">datetime</span><span class="o">.</span><span class="n">now</span><span class="p">()</span><span class="o">.</span><span class="n">strftime</span><span class="p">(</span><span class="s2">&quot;%Y-%m-</span><span class="si">%d</span><span class="s2"> %H:%M:%S&quot;</span><span class="p">)</span>
        <span class="n">full_status_msg</span> <span class="o">=</span> <span class="p">(</span>
            <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">date_str</span><span class="si">}</span><span class="s2">: &quot;</span>
            <span class="sa">f</span><span class="s2">&quot;(tstat:</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">thermostat_type</span><span class="si">}</span><span class="s2">, zone:</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">zone_name</span><span class="si">}</span><span class="s2">, &quot;</span>
            <span class="sa">f</span><span class="s2">&quot;session:</span><span class="si">{</span><span class="n">session_count</span><span class="si">}</span><span class="s2">, poll:</span><span class="si">{</span><span class="n">poll_count</span><span class="si">}</span><span class="s2">) &quot;</span>
            <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">current_mode</span><span class="o">.</span><span class="n">upper</span><span class="p">()</span><span class="si">}</span><span class="s2"> </span><span class="si">{</span><span class="n">status_msg</span><span class="si">}</span><span class="s2">&quot;</span>
        <span class="p">)</span>
        <span class="k">if</span> <span class="n">print_status</span><span class="p">:</span>
            <span class="n">util</span><span class="o">.</span><span class="n">log_msg</span><span class="p">(</span><span class="n">full_status_msg</span><span class="p">,</span> <span class="n">mode</span><span class="o">=</span><span class="n">util</span><span class="o">.</span><span class="n">BOTH_LOG</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">store_current_mode</span><span class="p">()</span>

        <span class="c1"># return status</span>
        <span class="n">return_buffer</span><span class="p">[</span><span class="s2">&quot;heat_mode&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">is_heat_mode</span><span class="p">()</span>
        <span class="n">return_buffer</span><span class="p">[</span><span class="s2">&quot;cool_mode&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">is_cool_mode</span><span class="p">()</span>
        <span class="n">return_buffer</span><span class="p">[</span><span class="s2">&quot;heat_deviation&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">is_heat_deviation</span><span class="p">()</span>
        <span class="n">return_buffer</span><span class="p">[</span><span class="s2">&quot;cool_deviation&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">is_cool_deviation</span><span class="p">()</span>
        <span class="n">return_buffer</span><span class="p">[</span><span class="s2">&quot;hold_mode&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">hold_mode</span>
        <span class="n">return_buffer</span><span class="p">[</span><span class="s2">&quot;status_msg&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">full_status_msg</span>
        <span class="k">return</span> <span class="n">return_buffer</span></div>


<div class="viewcode-block" id="ThermostatCommonZone.set_mode">
<a class="viewcode-back" href="../../docs/thermostatsupervisor.html#thermostatsupervisor.thermostat_common.ThermostatCommonZone.set_mode">[docs]</a>
    <span class="k">def</span> <span class="nf">set_mode</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">target_mode</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Set the thermostat mode.</span>

<span class="sd">        inputs:</span>
<span class="sd">            target_mode(str): target mode, refer to supported_configs[&quot;modes&quot;]</span>
<span class="sd">        returns:</span>
<span class="sd">            True if successful, else False</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">verbose</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;DEBUG in set_mode, target_mode=</span><span class="si">{</span><span class="n">target_mode</span><span class="si">}</span><span class="s2">, doing nothing&quot;</span><span class="p">)</span>
        <span class="k">return</span> <span class="kc">False</span></div>


<div class="viewcode-block" id="ThermostatCommonZone.store_current_mode">
<a class="viewcode-back" href="../../docs/thermostatsupervisor.html#thermostatsupervisor.thermostat_common.ThermostatCommonZone.store_current_mode">[docs]</a>
    <span class="k">def</span> <span class="nf">store_current_mode</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Save the current mode to cache.&quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">is_heat_mode</span><span class="p">():</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">current_mode</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">HEAT_MODE</span>
        <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">is_cool_mode</span><span class="p">():</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">current_mode</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">COOL_MODE</span>
        <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">is_dry_mode</span><span class="p">():</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">current_mode</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">DRY_MODE</span>
        <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">is_auto_mode</span><span class="p">():</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">current_mode</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">AUTO_MODE</span>
        <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">is_fan_mode</span><span class="p">():</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">current_mode</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">FAN_MODE</span>
        <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">is_off_mode</span><span class="p">():</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">current_mode</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">OFF_MODE</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;unknown thermostat mode&quot;</span><span class="p">)</span></div>


<div class="viewcode-block" id="ThermostatCommonZone.validate_numeric">
<a class="viewcode-back" href="../../docs/thermostatsupervisor.html#thermostatsupervisor.thermostat_common.ThermostatCommonZone.validate_numeric">[docs]</a>
    <span class="k">def</span> <span class="nf">validate_numeric</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">input_val</span><span class="p">,</span> <span class="n">parameter_name</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Validate value returned is numeric, otherwise raise exception.</span>

<span class="sd">        inputs:</span>
<span class="sd">            input_val: input value of unknown type.</span>
<span class="sd">            parameter_name(str): parameter name.</span>
<span class="sd">        returns:</span>
<span class="sd">            (int, float): pass thru value if numeric, else raise exception.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">input_val</span><span class="p">,</span> <span class="p">(</span><span class="nb">int</span><span class="p">,</span> <span class="nb">float</span><span class="p">)):</span>
            <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span>
                <span class="sa">f</span><span class="s2">&quot;value returned for parameter &#39;</span><span class="si">{</span><span class="n">parameter_name</span><span class="si">}</span><span class="s2">&#39; is &quot;</span>
                <span class="sa">f</span><span class="s2">&quot;type </span><span class="si">{</span><span class="nb">type</span><span class="p">(</span><span class="n">input_val</span><span class="p">)</span><span class="si">}</span><span class="s2">, expected int or float&quot;</span>
            <span class="p">)</span>
        <span class="k">return</span> <span class="n">input_val</span></div>


<div class="viewcode-block" id="ThermostatCommonZone.warn_if_outside_global_limit">
<a class="viewcode-back" href="../../docs/thermostatsupervisor.html#thermostatsupervisor.thermostat_common.ThermostatCommonZone.warn_if_outside_global_limit">[docs]</a>
    <span class="k">def</span> <span class="nf">warn_if_outside_global_limit</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">setpoint</span><span class="p">,</span> <span class="n">limit_value</span><span class="p">,</span> <span class="n">oper</span><span class="p">,</span> <span class="n">label</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Send warning email if setpoint is outside of global limits.</span>

<span class="sd">        inputs:</span>
<span class="sd">            setpoint(int): setpoint value.</span>
<span class="sd">            limit_value(int): the limit value</span>
<span class="sd">            oper(operator):  the operator, either operator.gt or operator.lt</span>
<span class="sd">            label(str): label for warning message denoting the mode</span>
<span class="sd">        returns:</span>
<span class="sd">            (bool): result of check</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">oper</span> <span class="o">==</span> <span class="n">operator</span><span class="o">.</span><span class="n">gt</span><span class="p">:</span>  <span class="c1"># pylint: disable=W0143</span>
            <span class="n">level</span> <span class="o">=</span> <span class="s2">&quot;above max&quot;</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">level</span> <span class="o">=</span> <span class="s2">&quot;below min&quot;</span>
        <span class="k">if</span> <span class="n">oper</span><span class="p">(</span><span class="n">setpoint</span><span class="p">,</span> <span class="n">limit_value</span><span class="p">):</span>
            <span class="n">msg</span> <span class="o">=</span> <span class="p">(</span>
                <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">thermostat_type</span><span class="si">}</span><span class="s2"> zone </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">zone_name</span><span class="si">}</span><span class="s2">: &quot;</span>
                <span class="sa">f</span><span class="s2">&quot;scheduled </span><span class="si">{</span><span class="n">label</span><span class="o">.</span><span class="n">upper</span><span class="p">()</span><span class="si">}</span><span class="s2"> set point &quot;</span>
                <span class="sa">f</span><span class="s2">&quot;(</span><span class="si">{</span><span class="n">util</span><span class="o">.</span><span class="n">temp_value_with_units</span><span class="p">(</span><span class="n">setpoint</span><span class="p">)</span><span class="si">}</span><span class="s2">) is </span><span class="si">{</span><span class="n">level</span><span class="si">}</span><span class="s2"> &quot;</span>
                <span class="sa">f</span><span class="s2">&quot;limit (</span><span class="si">{</span><span class="n">util</span><span class="o">.</span><span class="n">temp_value_with_units</span><span class="p">(</span><span class="n">limit_value</span><span class="p">)</span><span class="si">}</span><span class="s2">)&quot;</span>
            <span class="p">)</span>
            <span class="n">util</span><span class="o">.</span><span class="n">log_msg</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;WARNING: </span><span class="si">{</span><span class="n">msg</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">mode</span><span class="o">=</span><span class="n">util</span><span class="o">.</span><span class="n">BOTH_LOG</span><span class="p">)</span>
            <span class="n">eml</span><span class="o">.</span><span class="n">send_email_alert</span><span class="p">(</span><span class="n">subject</span><span class="o">=</span><span class="n">msg</span><span class="p">,</span> <span class="n">body</span><span class="o">=</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">util</span><span class="o">.</span><span class="n">get_function_name</span><span class="p">()</span><span class="si">}</span><span class="s2">: </span><span class="si">{</span><span class="n">msg</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
            <span class="k">return</span> <span class="kc">True</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="kc">False</span></div>


<div class="viewcode-block" id="ThermostatCommonZone.is_heat_mode">
<a class="viewcode-back" href="../../docs/thermostatsupervisor.html#thermostatsupervisor.thermostat_common.ThermostatCommonZone.is_heat_mode">[docs]</a>
    <span class="k">def</span> <span class="nf">is_heat_mode</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Return True if in heat mode.&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">get_system_switch_position</span><span class="p">()</span>
            <span class="o">==</span> <span class="bp">self</span><span class="o">.</span><span class="n">system_switch_position</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">HEAT_MODE</span><span class="p">]</span>
        <span class="p">)</span></div>


<div class="viewcode-block" id="ThermostatCommonZone.is_cool_mode">
<a class="viewcode-back" href="../../docs/thermostatsupervisor.html#thermostatsupervisor.thermostat_common.ThermostatCommonZone.is_cool_mode">[docs]</a>
    <span class="k">def</span> <span class="nf">is_cool_mode</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Return True if in cool mode.&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">get_system_switch_position</span><span class="p">()</span>
            <span class="o">==</span> <span class="bp">self</span><span class="o">.</span><span class="n">system_switch_position</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">COOL_MODE</span><span class="p">]</span>
        <span class="p">)</span></div>


<div class="viewcode-block" id="ThermostatCommonZone.is_dry_mode">
<a class="viewcode-back" href="../../docs/thermostatsupervisor.html#thermostatsupervisor.thermostat_common.ThermostatCommonZone.is_dry_mode">[docs]</a>
    <span class="k">def</span> <span class="nf">is_dry_mode</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Return True if in dry mode.&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">get_system_switch_position</span><span class="p">()</span>
            <span class="o">==</span> <span class="bp">self</span><span class="o">.</span><span class="n">system_switch_position</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">DRY_MODE</span><span class="p">]</span>
        <span class="p">)</span></div>


<div class="viewcode-block" id="ThermostatCommonZone.is_auto_mode">
<a class="viewcode-back" href="../../docs/thermostatsupervisor.html#thermostatsupervisor.thermostat_common.ThermostatCommonZone.is_auto_mode">[docs]</a>
    <span class="k">def</span> <span class="nf">is_auto_mode</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Return True if in auto mode.&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">get_system_switch_position</span><span class="p">()</span>
            <span class="o">==</span> <span class="bp">self</span><span class="o">.</span><span class="n">system_switch_position</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">AUTO_MODE</span><span class="p">]</span>
        <span class="p">)</span></div>


<div class="viewcode-block" id="ThermostatCommonZone.is_fan_mode">
<a class="viewcode-back" href="../../docs/thermostatsupervisor.html#thermostatsupervisor.thermostat_common.ThermostatCommonZone.is_fan_mode">[docs]</a>
    <span class="k">def</span> <span class="nf">is_fan_mode</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Return 1 if fan mode enabled, else 0.&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">get_system_switch_position</span><span class="p">()</span>
            <span class="o">==</span> <span class="bp">self</span><span class="o">.</span><span class="n">system_switch_position</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">FAN_MODE</span><span class="p">]</span>
        <span class="p">)</span></div>


<div class="viewcode-block" id="ThermostatCommonZone.is_off_mode">
<a class="viewcode-back" href="../../docs/thermostatsupervisor.html#thermostatsupervisor.thermostat_common.ThermostatCommonZone.is_off_mode">[docs]</a>
    <span class="k">def</span> <span class="nf">is_off_mode</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Return 1 if fan mode enabled, else 0.&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">get_system_switch_position</span><span class="p">()</span>
            <span class="o">==</span> <span class="bp">self</span><span class="o">.</span><span class="n">system_switch_position</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">OFF_MODE</span><span class="p">]</span>
        <span class="p">)</span></div>


<div class="viewcode-block" id="ThermostatCommonZone.is_controlled_mode">
<a class="viewcode-back" href="../../docs/thermostatsupervisor.html#thermostatsupervisor.thermostat_common.ThermostatCommonZone.is_controlled_mode">[docs]</a>
    <span class="k">def</span> <span class="nf">is_controlled_mode</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Return True if mode is being controlled.&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">current_mode</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">controlled_modes</span></div>


<div class="viewcode-block" id="ThermostatCommonZone.is_heating">
<a class="viewcode-back" href="../../docs/thermostatsupervisor.html#thermostatsupervisor.thermostat_common.ThermostatCommonZone.is_heating">[docs]</a>
    <span class="k">def</span> <span class="nf">is_heating</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>  <span class="c1"># noqa R0201</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Return 1 if heating relay is active, else 0.&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="n">util</span><span class="o">.</span><span class="n">BOGUS_INT</span></div>


<div class="viewcode-block" id="ThermostatCommonZone.is_cooling">
<a class="viewcode-back" href="../../docs/thermostatsupervisor.html#thermostatsupervisor.thermostat_common.ThermostatCommonZone.is_cooling">[docs]</a>
    <span class="k">def</span> <span class="nf">is_cooling</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>  <span class="c1"># noqa R0201</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Return 1 if cooling relay is active, else 0.&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="n">util</span><span class="o">.</span><span class="n">BOGUS_INT</span></div>


<div class="viewcode-block" id="ThermostatCommonZone.is_drying">
<a class="viewcode-back" href="../../docs/thermostatsupervisor.html#thermostatsupervisor.thermostat_common.ThermostatCommonZone.is_drying">[docs]</a>
    <span class="k">def</span> <span class="nf">is_drying</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>  <span class="c1"># noqa R0201</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Return 1 if drying relay is active, else 0.&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="n">util</span><span class="o">.</span><span class="n">BOGUS_INT</span></div>


<div class="viewcode-block" id="ThermostatCommonZone.is_auto">
<a class="viewcode-back" href="../../docs/thermostatsupervisor.html#thermostatsupervisor.thermostat_common.ThermostatCommonZone.is_auto">[docs]</a>
    <span class="k">def</span> <span class="nf">is_auto</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>  <span class="c1"># noqa R0201</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Return 1 if auto relay is active, else 0.&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="n">util</span><span class="o">.</span><span class="n">BOGUS_INT</span></div>


<div class="viewcode-block" id="ThermostatCommonZone.is_fanning">
<a class="viewcode-back" href="../../docs/thermostatsupervisor.html#thermostatsupervisor.thermostat_common.ThermostatCommonZone.is_fanning">[docs]</a>
    <span class="k">def</span> <span class="nf">is_fanning</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>  <span class="c1"># noqa R0201</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Return 1 if fan relay is active, else 0.&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="n">util</span><span class="o">.</span><span class="n">BOGUS_INT</span></div>


<div class="viewcode-block" id="ThermostatCommonZone.set_heat_setpoint">
<a class="viewcode-back" href="../../docs/thermostatsupervisor.html#thermostatsupervisor.thermostat_common.ThermostatCommonZone.set_heat_setpoint">[docs]</a>
    <span class="k">def</span> <span class="nf">set_heat_setpoint</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">temp</span><span class="p">:</span> <span class="nb">int</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>  <span class="c1"># noqa R0201</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Set a new heat setpoint.</span>

<span class="sd">        This will also attempt to turn the thermostat to &#39;Cool&#39;</span>
<span class="sd">        inputs:</span>
<span class="sd">            temp(int): desired temperature in °F.</span>
<span class="sd">        returns:</span>
<span class="sd">            None</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">del</span> <span class="n">temp</span>
        <span class="n">util</span><span class="o">.</span><span class="n">log_msg</span><span class="p">(</span>
            <span class="sa">f</span><span class="s2">&quot;WARNING: </span><span class="si">{</span><span class="n">util</span><span class="o">.</span><span class="n">get_function_name</span><span class="p">()</span><span class="si">}</span><span class="s2">: function is not yet &quot;</span>
            <span class="sa">f</span><span class="s2">&quot;implemented on this thermostat, doing nothing&quot;</span><span class="p">,</span>
            <span class="n">mode</span><span class="o">=</span><span class="n">util</span><span class="o">.</span><span class="n">BOTH_LOG</span><span class="p">,</span>
            <span class="n">func_name</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
        <span class="p">)</span></div>


<div class="viewcode-block" id="ThermostatCommonZone.set_cool_setpoint">
<a class="viewcode-back" href="../../docs/thermostatsupervisor.html#thermostatsupervisor.thermostat_common.ThermostatCommonZone.set_cool_setpoint">[docs]</a>
    <span class="k">def</span> <span class="nf">set_cool_setpoint</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">temp</span><span class="p">:</span> <span class="nb">int</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>  <span class="c1"># noqa R0201</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Set a new cool setpoint.</span>

<span class="sd">        This will also attempt to turn the thermostat to &#39;Cool&#39;</span>
<span class="sd">        inputs:</span>
<span class="sd">            temp(int): desired temperature in °F.</span>
<span class="sd">        returns:</span>
<span class="sd">            None</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">del</span> <span class="n">temp</span>
        <span class="n">util</span><span class="o">.</span><span class="n">log_msg</span><span class="p">(</span>
            <span class="sa">f</span><span class="s2">&quot;WARNING: </span><span class="si">{</span><span class="n">util</span><span class="o">.</span><span class="n">get_function_name</span><span class="p">()</span><span class="si">}</span><span class="s2">: function is not yet &quot;</span>
            <span class="sa">f</span><span class="s2">&quot;implemented on this thermostat, doing nothing&quot;</span><span class="p">,</span>
            <span class="n">mode</span><span class="o">=</span><span class="n">util</span><span class="o">.</span><span class="n">BOTH_LOG</span><span class="p">,</span>
            <span class="n">func_name</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
        <span class="p">)</span></div>


<div class="viewcode-block" id="ThermostatCommonZone.is_heat_deviation">
<a class="viewcode-back" href="../../docs/thermostatsupervisor.html#thermostatsupervisor.thermostat_common.ThermostatCommonZone.is_heat_deviation">[docs]</a>
    <span class="k">def</span> <span class="nf">is_heat_deviation</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Return True if heat is deviated.</span>

<span class="sd">        inputs:</span>
<span class="sd">            None</span>
<span class="sd">        returns:</span>
<span class="sd">            (bool): True if deviation exists.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">is_heat_mode</span><span class="p">()</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">is_temp_deviated_from_schedule</span><span class="p">()</span></div>


<div class="viewcode-block" id="ThermostatCommonZone.is_cool_deviation">
<a class="viewcode-back" href="../../docs/thermostatsupervisor.html#thermostatsupervisor.thermostat_common.ThermostatCommonZone.is_cool_deviation">[docs]</a>
    <span class="k">def</span> <span class="nf">is_cool_deviation</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Return True if cool is deviated.</span>

<span class="sd">        inputs:</span>
<span class="sd">            None</span>
<span class="sd">        returns:</span>
<span class="sd">            (bool): True if deviation exists.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">is_cool_mode</span><span class="p">()</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">is_temp_deviated_from_schedule</span><span class="p">()</span></div>


    <span class="c1"># Thermostat-specific methods will be overloaded</span>
<div class="viewcode-block" id="ThermostatCommonZone.get_display_temp">
<a class="viewcode-back" href="../../docs/thermostatsupervisor.html#thermostatsupervisor.thermostat_common.ThermostatCommonZone.get_display_temp">[docs]</a>
    <span class="k">def</span> <span class="nf">get_display_temp</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">float</span><span class="p">:</span>  <span class="c1"># noqa R0201</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Return the displayed temperature.&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="nb">float</span><span class="p">(</span><span class="n">util</span><span class="o">.</span><span class="n">BOGUS_INT</span><span class="p">)</span>  <span class="c1"># placeholder</span></div>


<div class="viewcode-block" id="ThermostatCommonZone.get_display_humidity">
<a class="viewcode-back" href="../../docs/thermostatsupervisor.html#thermostatsupervisor.thermostat_common.ThermostatCommonZone.get_display_humidity">[docs]</a>
    <span class="k">def</span> <span class="nf">get_display_humidity</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">float</span><span class="p">:</span>  <span class="c1"># noqa R0201</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Return the displayed humidity.&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="nb">float</span><span class="p">(</span><span class="n">util</span><span class="o">.</span><span class="n">BOGUS_INT</span><span class="p">)</span>  <span class="c1"># placeholder</span></div>


<div class="viewcode-block" id="ThermostatCommonZone.get_is_humidity_supported">
<a class="viewcode-back" href="../../docs/thermostatsupervisor.html#thermostatsupervisor.thermostat_common.ThermostatCommonZone.get_is_humidity_supported">[docs]</a>
    <span class="k">def</span> <span class="nf">get_is_humidity_supported</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>  <span class="c1"># noqa R0201</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Return humidity sensor status.&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="n">util</span><span class="o">.</span><span class="n">BOGUS_BOOL</span>  <span class="c1"># placeholder</span></div>


<div class="viewcode-block" id="ThermostatCommonZone.get_system_switch_position">
<a class="viewcode-back" href="../../docs/thermostatsupervisor.html#thermostatsupervisor.thermostat_common.ThermostatCommonZone.get_system_switch_position">[docs]</a>
    <span class="k">def</span> <span class="nf">get_system_switch_position</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">int</span><span class="p">:</span>  <span class="c1"># noqa R0201</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Return the &#39;SystemSwitchPosition&#39;</span>
<span class="sd">        &#39;SystemSwitchPosition&#39; = 1 for heat, 2 for off</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="n">util</span><span class="o">.</span><span class="n">BOGUS_INT</span>  <span class="c1"># placeholder</span></div>


<div class="viewcode-block" id="ThermostatCommonZone.get_heat_setpoint_raw">
<a class="viewcode-back" href="../../docs/thermostatsupervisor.html#thermostatsupervisor.thermostat_common.ThermostatCommonZone.get_heat_setpoint_raw">[docs]</a>
    <span class="k">def</span> <span class="nf">get_heat_setpoint_raw</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">float</span><span class="p">:</span>  <span class="c1"># noqa R0201</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Return raw heat set point(number only, no units).&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="nb">float</span><span class="p">(</span><span class="n">util</span><span class="o">.</span><span class="n">BOGUS_INT</span><span class="p">)</span>  <span class="c1"># placeholder</span></div>


<div class="viewcode-block" id="ThermostatCommonZone.get_heat_setpoint">
<a class="viewcode-back" href="../../docs/thermostatsupervisor.html#thermostatsupervisor.thermostat_common.ThermostatCommonZone.get_heat_setpoint">[docs]</a>
    <span class="k">def</span> <span class="nf">get_heat_setpoint</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>  <span class="c1"># noqa R0201</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Return raw heat set point(number and units).&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="n">util</span><span class="o">.</span><span class="n">BOGUS_STR</span>  <span class="c1"># placeholder</span></div>


<div class="viewcode-block" id="ThermostatCommonZone.get_schedule_program_heat">
<a class="viewcode-back" href="../../docs/thermostatsupervisor.html#thermostatsupervisor.thermostat_common.ThermostatCommonZone.get_schedule_program_heat">[docs]</a>
    <span class="k">def</span> <span class="nf">get_schedule_program_heat</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">dict</span><span class="p">:</span>  <span class="c1"># noqa R0201</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Return the heat setpoint schedule.</span>

<span class="sd">        inputs:</span>
<span class="sd">            None</span>
<span class="sd">        returns:</span>
<span class="sd">            (dict): scheduled heat set points and times in °F.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="n">util</span><span class="o">.</span><span class="n">bogus_dict</span>  <span class="c1"># placeholder</span></div>


<div class="viewcode-block" id="ThermostatCommonZone.get_schedule_heat_sp">
<a class="viewcode-back" href="../../docs/thermostatsupervisor.html#thermostatsupervisor.thermostat_common.ThermostatCommonZone.get_schedule_heat_sp">[docs]</a>
    <span class="k">def</span> <span class="nf">get_schedule_heat_sp</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">float</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Return the heat setpoint.&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="nb">float</span><span class="p">(</span><span class="n">util</span><span class="o">.</span><span class="n">BOGUS_INT</span><span class="p">)</span>  <span class="c1"># placeholder</span></div>


<div class="viewcode-block" id="ThermostatCommonZone.get_cool_setpoint_raw">
<a class="viewcode-back" href="../../docs/thermostatsupervisor.html#thermostatsupervisor.thermostat_common.ThermostatCommonZone.get_cool_setpoint_raw">[docs]</a>
    <span class="k">def</span> <span class="nf">get_cool_setpoint_raw</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">float</span><span class="p">:</span>  <span class="c1"># noqa R0201</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Return raw cool set point (number only, no units).&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="nb">float</span><span class="p">(</span><span class="n">util</span><span class="o">.</span><span class="n">BOGUS_INT</span><span class="p">)</span>  <span class="c1"># placeholder</span></div>


<div class="viewcode-block" id="ThermostatCommonZone.get_cool_setpoint">
<a class="viewcode-back" href="../../docs/thermostatsupervisor.html#thermostatsupervisor.thermostat_common.ThermostatCommonZone.get_cool_setpoint">[docs]</a>
    <span class="k">def</span> <span class="nf">get_cool_setpoint</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">int</span><span class="p">:</span>  <span class="c1"># noqa R0201</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Return raw cool set point (number and units).&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="n">util</span><span class="o">.</span><span class="n">BOGUS_INT</span>  <span class="c1"># placeholder</span></div>


<div class="viewcode-block" id="ThermostatCommonZone.get_schedule_program_cool">
<a class="viewcode-back" href="../../docs/thermostatsupervisor.html#thermostatsupervisor.thermostat_common.ThermostatCommonZone.get_schedule_program_cool">[docs]</a>
    <span class="k">def</span> <span class="nf">get_schedule_program_cool</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">dict</span><span class="p">:</span>  <span class="c1"># noqa R0201</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Return the cool setpoint schedule.</span>

<span class="sd">        inputs:</span>
<span class="sd">            None</span>
<span class="sd">        returns:</span>
<span class="sd">            (dict): scheduled cool set points and times in °F.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="n">util</span><span class="o">.</span><span class="n">bogus_dict</span>  <span class="c1"># placeholder</span></div>


<div class="viewcode-block" id="ThermostatCommonZone.get_schedule_cool_sp">
<a class="viewcode-back" href="../../docs/thermostatsupervisor.html#thermostatsupervisor.thermostat_common.ThermostatCommonZone.get_schedule_cool_sp">[docs]</a>
    <span class="k">def</span> <span class="nf">get_schedule_cool_sp</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">float</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Return the cool setpoint.&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="nb">float</span><span class="p">(</span><span class="n">util</span><span class="o">.</span><span class="n">BOGUS_INT</span><span class="p">)</span>  <span class="c1"># placeholder</span></div>


<div class="viewcode-block" id="ThermostatCommonZone.get_vacation_hold">
<a class="viewcode-back" href="../../docs/thermostatsupervisor.html#thermostatsupervisor.thermostat_common.ThermostatCommonZone.get_vacation_hold">[docs]</a>
    <span class="k">def</span> <span class="nf">get_vacation_hold</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>  <span class="c1"># noqa R0201</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Return True if thermostat is in vacation hold mode.&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="n">util</span><span class="o">.</span><span class="n">BOGUS_BOOL</span>  <span class="c1"># placeholder</span></div>


<div class="viewcode-block" id="ThermostatCommonZone.get_is_invacation_hold_mode">
<a class="viewcode-back" href="../../docs/thermostatsupervisor.html#thermostatsupervisor.thermostat_common.ThermostatCommonZone.get_is_invacation_hold_mode">[docs]</a>
    <span class="k">def</span> <span class="nf">get_is_invacation_hold_mode</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>  <span class="c1"># noqa R0201</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Return the &#39;IsInVacationHoldMode&#39; setting.&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="n">util</span><span class="o">.</span><span class="n">BOGUS_BOOL</span>  <span class="c1"># placeholder</span></div>


<div class="viewcode-block" id="ThermostatCommonZone.get_temporary_hold_until_time">
<a class="viewcode-back" href="../../docs/thermostatsupervisor.html#thermostatsupervisor.thermostat_common.ThermostatCommonZone.get_temporary_hold_until_time">[docs]</a>
    <span class="k">def</span> <span class="nf">get_temporary_hold_until_time</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">int</span><span class="p">:</span>  <span class="c1"># noqa R0201</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Return the &#39;TemporaryHoldUntilTime&#39;&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="n">util</span><span class="o">.</span><span class="n">BOGUS_INT</span>  <span class="c1"># placeholder</span></div>


<div class="viewcode-block" id="ThermostatCommonZone.get_wifi_strength">
<a class="viewcode-back" href="../../docs/thermostatsupervisor.html#thermostatsupervisor.thermostat_common.ThermostatCommonZone.get_wifi_strength">[docs]</a>
    <span class="k">def</span> <span class="nf">get_wifi_strength</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">float</span><span class="p">:</span>  <span class="c1"># noqa R0201</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Return the wifi signal strength in dBm.&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="nb">float</span><span class="p">(</span><span class="n">util</span><span class="o">.</span><span class="n">BOGUS_INT</span><span class="p">)</span>  <span class="c1"># placeholder</span></div>


<div class="viewcode-block" id="ThermostatCommonZone.get_wifi_status">
<a class="viewcode-back" href="../../docs/thermostatsupervisor.html#thermostatsupervisor.thermostat_common.ThermostatCommonZone.get_wifi_status">[docs]</a>
    <span class="k">def</span> <span class="nf">get_wifi_status</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>  <span class="c1"># noqa R0201</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Return the wifi connection status.&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="n">util</span><span class="o">.</span><span class="n">BOGUS_BOOL</span>  <span class="c1"># placeholder</span></div>


<div class="viewcode-block" id="ThermostatCommonZone.get_battery_voltage">
<a class="viewcode-back" href="../../docs/thermostatsupervisor.html#thermostatsupervisor.thermostat_common.ThermostatCommonZone.get_battery_voltage">[docs]</a>
    <span class="k">def</span> <span class="nf">get_battery_voltage</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">float</span><span class="p">:</span>  <span class="c1"># noqa R0201</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Return the battery voltage in volts.&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="nb">float</span><span class="p">(</span><span class="n">util</span><span class="o">.</span><span class="n">BOGUS_INT</span><span class="p">)</span>  <span class="c1"># placeholder</span></div>


<div class="viewcode-block" id="ThermostatCommonZone.get_battery_status">
<a class="viewcode-back" href="../../docs/thermostatsupervisor.html#thermostatsupervisor.thermostat_common.ThermostatCommonZone.get_battery_status">[docs]</a>
    <span class="k">def</span> <span class="nf">get_battery_status</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>  <span class="c1"># noqa R0201</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Return the battery status.&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="n">util</span><span class="o">.</span><span class="n">BOGUS_BOOL</span>  <span class="c1"># placeholder</span></div>


<div class="viewcode-block" id="ThermostatCommonZone.refresh_zone_info">
<a class="viewcode-back" href="../../docs/thermostatsupervisor.html#thermostatsupervisor.thermostat_common.ThermostatCommonZone.refresh_zone_info">[docs]</a>
    <span class="k">def</span> <span class="nf">refresh_zone_info</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">force_refresh</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Refresh zone info.</span>

<span class="sd">        inputs:</span>
<span class="sd">            force_refresh(bool): if True, ignore expiration timer.</span>
<span class="sd">        returns:</span>
<span class="sd">            None, cached data is refreshed.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">now_time</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span>
        <span class="c1"># refresh if past expiration date or force_refresh option</span>
        <span class="k">if</span> <span class="n">force_refresh</span> <span class="ow">or</span> <span class="p">(</span>
            <span class="n">now_time</span> <span class="o">&gt;=</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">last_fetch_time</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">fetch_interval_sec</span><span class="p">)</span>
        <span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">zone_info</span> <span class="o">=</span> <span class="p">{}</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">last_fetch_time</span> <span class="o">=</span> <span class="n">now_time</span></div>


<div class="viewcode-block" id="ThermostatCommonZone.report_heating_parameters">
<a class="viewcode-back" href="../../docs/thermostatsupervisor.html#thermostatsupervisor.thermostat_common.ThermostatCommonZone.report_heating_parameters">[docs]</a>
    <span class="k">def</span> <span class="nf">report_heating_parameters</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">switch_position</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Display critical thermostat settings and reading to the screen.</span>

<span class="sd">        inputs:</span>
<span class="sd">            switch_position(int): switch position override, used for testing.</span>
<span class="sd">        returns:</span>
<span class="sd">            None</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># current temp as measured by thermostat</span>
        <span class="n">util</span><span class="o">.</span><span class="n">log_msg</span><span class="p">(</span>
            <span class="sa">f</span><span class="s2">&quot;display temp=&quot;</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">util</span><span class="o">.</span><span class="n">temp_value_with_units</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">get_display_temp</span><span class="p">())</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span>
            <span class="n">mode</span><span class="o">=</span><span class="n">util</span><span class="o">.</span><span class="n">BOTH_LOG</span><span class="p">,</span>
            <span class="n">func_name</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
        <span class="p">)</span>

        <span class="c1"># get switch position</span>
        <span class="k">if</span> <span class="n">switch_position</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">switch_position</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_system_switch_position</span><span class="p">()</span>

        <span class="c1"># heating status</span>
        <span class="k">if</span> <span class="n">switch_position</span> <span class="o">==</span> <span class="bp">self</span><span class="o">.</span><span class="n">system_switch_position</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">HEAT_MODE</span><span class="p">]:</span>
            <span class="n">util</span><span class="o">.</span><span class="n">log_msg</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;heat mode=</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">is_heat_mode</span><span class="p">()</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">mode</span><span class="o">=</span><span class="n">util</span><span class="o">.</span><span class="n">BOTH_LOG</span><span class="p">)</span>
            <span class="n">util</span><span class="o">.</span><span class="n">log_msg</span><span class="p">(</span>
                <span class="sa">f</span><span class="s2">&quot;heat setpoint=</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">get_heat_setpoint_raw</span><span class="p">()</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">mode</span><span class="o">=</span><span class="n">util</span><span class="o">.</span><span class="n">BOTH_LOG</span>
            <span class="p">)</span>
            <span class="n">util</span><span class="o">.</span><span class="n">log_msg</span><span class="p">(</span>
                <span class="sa">f</span><span class="s2">&quot;schedule heat sp=</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">get_schedule_heat_sp</span><span class="p">()</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">mode</span><span class="o">=</span><span class="n">util</span><span class="o">.</span><span class="n">BOTH_LOG</span>
            <span class="p">)</span>

        <span class="c1"># cooling status</span>
        <span class="k">if</span> <span class="n">switch_position</span> <span class="o">==</span> <span class="bp">self</span><span class="o">.</span><span class="n">system_switch_position</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">COOL_MODE</span><span class="p">]:</span>
            <span class="n">util</span><span class="o">.</span><span class="n">log_msg</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;cool mode=</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">is_cool_mode</span><span class="p">()</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">mode</span><span class="o">=</span><span class="n">util</span><span class="o">.</span><span class="n">BOTH_LOG</span><span class="p">)</span>
            <span class="n">util</span><span class="o">.</span><span class="n">log_msg</span><span class="p">(</span>
                <span class="sa">f</span><span class="s2">&quot;cool setpoint=</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">get_cool_setpoint_raw</span><span class="p">()</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">mode</span><span class="o">=</span><span class="n">util</span><span class="o">.</span><span class="n">BOTH_LOG</span>
            <span class="p">)</span>
            <span class="n">util</span><span class="o">.</span><span class="n">log_msg</span><span class="p">(</span>
                <span class="sa">f</span><span class="s2">&quot;schedule cool sp=</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">get_schedule_cool_sp</span><span class="p">()</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">mode</span><span class="o">=</span><span class="n">util</span><span class="o">.</span><span class="n">BOTH_LOG</span>
            <span class="p">)</span>

        <span class="c1"># hold settings</span>
        <span class="n">util</span><span class="o">.</span><span class="n">log_msg</span><span class="p">(</span>
            <span class="sa">f</span><span class="s2">&quot;is in vacation hold mode=</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">get_is_invacation_hold_mode</span><span class="p">()</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span>
            <span class="n">mode</span><span class="o">=</span><span class="n">util</span><span class="o">.</span><span class="n">BOTH_LOG</span><span class="p">,</span>
        <span class="p">)</span>
        <span class="n">util</span><span class="o">.</span><span class="n">log_msg</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;vacation hold=</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">get_vacation_hold</span><span class="p">()</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">mode</span><span class="o">=</span><span class="n">util</span><span class="o">.</span><span class="n">BOTH_LOG</span><span class="p">)</span>
        <span class="n">util</span><span class="o">.</span><span class="n">log_msg</span><span class="p">(</span>
            <span class="sa">f</span><span class="s2">&quot;vacation hold until time=</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">get_vacation_hold_until_time</span><span class="p">()</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span>
            <span class="n">mode</span><span class="o">=</span><span class="n">util</span><span class="o">.</span><span class="n">BOTH_LOG</span><span class="p">,</span>
        <span class="p">)</span>
        <span class="n">util</span><span class="o">.</span><span class="n">log_msg</span><span class="p">(</span>
            <span class="sa">f</span><span class="s2">&quot;temporary hold until time=&quot;</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">get_temporary_hold_until_time</span><span class="p">()</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span>
            <span class="n">mode</span><span class="o">=</span><span class="n">util</span><span class="o">.</span><span class="n">BOTH_LOG</span><span class="p">,</span>
        <span class="p">)</span></div>


<div class="viewcode-block" id="ThermostatCommonZone.get_vacation_hold_until_time">
<a class="viewcode-back" href="../../docs/thermostatsupervisor.html#thermostatsupervisor.thermostat_common.ThermostatCommonZone.get_vacation_hold_until_time">[docs]</a>
    <span class="k">def</span> <span class="nf">get_vacation_hold_until_time</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">int</span><span class="p">:</span>  <span class="c1"># noqa R0201</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Return the &#39;VacationHoldUntilTime&#39;.</span>

<span class="sd">        inputs:</span>
<span class="sd">            None</span>
<span class="sd">        returns:</span>
<span class="sd">            (int): vacation hold time in minutes.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="n">util</span><span class="o">.</span><span class="n">BOGUS_INT</span>  <span class="c1"># not implemented</span></div>


<div class="viewcode-block" id="ThermostatCommonZone.update_runtime_parameters">
<a class="viewcode-back" href="../../docs/thermostatsupervisor.html#thermostatsupervisor.thermostat_common.ThermostatCommonZone.update_runtime_parameters">[docs]</a>
    <span class="k">def</span> <span class="nf">update_runtime_parameters</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;use runtime parameter overrides.</span>

<span class="sd">        inputs:</span>
<span class="sd">            None</span>
<span class="sd">        returns:</span>
<span class="sd">            None, updates class variables.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># map user input keys to class members.</span>
        <span class="c1"># &quot;thermostat_type is not overwritten</span>
        <span class="n">user_input_to_class_mapping</span> <span class="o">=</span> <span class="p">{</span>
            <span class="n">api</span><span class="o">.</span><span class="n">input_flds</span><span class="o">.</span><span class="n">thermostat_type</span><span class="p">:</span> <span class="s2">&quot;thermostat_type&quot;</span><span class="p">,</span>
            <span class="n">api</span><span class="o">.</span><span class="n">input_flds</span><span class="o">.</span><span class="n">zone</span><span class="p">:</span> <span class="s2">&quot;zone_number&quot;</span><span class="p">,</span>
            <span class="n">api</span><span class="o">.</span><span class="n">input_flds</span><span class="o">.</span><span class="n">poll_time</span><span class="p">:</span> <span class="s2">&quot;poll_time_sec&quot;</span><span class="p">,</span>
            <span class="n">api</span><span class="o">.</span><span class="n">input_flds</span><span class="o">.</span><span class="n">connection_time</span><span class="p">:</span> <span class="s2">&quot;connection_time_sec&quot;</span><span class="p">,</span>
            <span class="n">api</span><span class="o">.</span><span class="n">input_flds</span><span class="o">.</span><span class="n">tolerance</span><span class="p">:</span> <span class="s2">&quot;tolerance_degrees&quot;</span><span class="p">,</span>
            <span class="n">api</span><span class="o">.</span><span class="n">input_flds</span><span class="o">.</span><span class="n">target_mode</span><span class="p">:</span> <span class="s2">&quot;target_mode&quot;</span><span class="p">,</span>
            <span class="n">api</span><span class="o">.</span><span class="n">input_flds</span><span class="o">.</span><span class="n">measurements</span><span class="p">:</span> <span class="s2">&quot;measurements&quot;</span><span class="p">,</span>
        <span class="p">}</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">verbose</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
            <span class="n">util</span><span class="o">.</span><span class="n">log_msg</span><span class="p">(</span>
                <span class="s2">&quot;supervisor runtime parameters:&quot;</span><span class="p">,</span> <span class="n">mode</span><span class="o">=</span><span class="n">util</span><span class="o">.</span><span class="n">BOTH_LOG</span><span class="p">,</span> <span class="n">func_name</span><span class="o">=</span><span class="mi">1</span>
            <span class="p">)</span>
        <span class="k">for</span> <span class="n">inp</span><span class="p">,</span> <span class="n">cls_method</span> <span class="ow">in</span> <span class="n">user_input_to_class_mapping</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="n">user_input</span> <span class="o">=</span> <span class="n">api</span><span class="o">.</span><span class="n">uip</span><span class="o">.</span><span class="n">get_user_inputs</span><span class="p">(</span><span class="n">api</span><span class="o">.</span><span class="n">uip</span><span class="o">.</span><span class="n">zone_name</span><span class="p">,</span> <span class="n">inp</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">user_input</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                <span class="nb">setattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">cls_method</span><span class="p">,</span> <span class="n">user_input</span><span class="p">)</span>
                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">verbose</span><span class="p">:</span>
                    <span class="n">util</span><span class="o">.</span><span class="n">log_msg</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">inp</span><span class="si">}</span><span class="s2">=</span><span class="si">{</span><span class="n">user_input</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">mode</span><span class="o">=</span><span class="n">util</span><span class="o">.</span><span class="n">BOTH_LOG</span><span class="p">,</span> <span class="n">func_name</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span></div>


<div class="viewcode-block" id="ThermostatCommonZone.verify_current_mode">
<a class="viewcode-back" href="../../docs/thermostatsupervisor.html#thermostatsupervisor.thermostat_common.ThermostatCommonZone.verify_current_mode">[docs]</a>
    <span class="k">def</span> <span class="nf">verify_current_mode</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">target_mode</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Verify current mode matches target mode.</span>

<span class="sd">        inputs:</span>
<span class="sd">            target_mode(str): target mode override</span>
<span class="sd">        returns:</span>
<span class="sd">            (bool): True if current mode matches target mode,</span>
<span class="sd">                    or target mode is not specified.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">target_mode</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">return</span> <span class="kc">True</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="nb">bool</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">current_mode</span> <span class="o">==</span> <span class="n">target_mode</span><span class="p">)</span></div>


<div class="viewcode-block" id="ThermostatCommonZone.revert_thermostat_mode">
<a class="viewcode-back" href="../../docs/thermostatsupervisor.html#thermostatsupervisor.thermostat_common.ThermostatCommonZone.revert_thermostat_mode">[docs]</a>
    <span class="k">def</span> <span class="nf">revert_thermostat_mode</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">target_mode</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Revert thermostat mode to target mode.</span>

<span class="sd">        inputs:</span>
<span class="sd">            target_mode(str): target mode override</span>
<span class="sd">        returns:</span>
<span class="sd">            target_mode(str) target_mode, which may get updated by</span>
<span class="sd">            this function.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># do not switch directly from hot to cold</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">current_mode</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">heat_modes</span> <span class="ow">and</span> <span class="n">target_mode</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">cool_modes</span><span class="p">:</span>
            <span class="n">util</span><span class="o">.</span><span class="n">log_msg</span><span class="p">(</span>
                <span class="sa">f</span><span class="s2">&quot;WARNING: target mode=</span><span class="si">{</span><span class="n">target_mode</span><span class="si">}</span><span class="s2">, switching from &quot;</span>
                <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">current_mode</span><span class="si">}</span><span class="s2"> to OFF_MODE to prevent damage to HVAC&quot;</span><span class="p">,</span>
                <span class="n">mode</span><span class="o">=</span><span class="n">util</span><span class="o">.</span><span class="n">BOTH_LOG</span><span class="p">,</span>
                <span class="n">func_name</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
            <span class="p">)</span>
            <span class="n">target_mode</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">OFF_MODE</span>

        <span class="c1"># do not switch directly from cold to hot</span>
        <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">current_mode</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">cool_modes</span> <span class="ow">and</span> <span class="n">target_mode</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">heat_modes</span><span class="p">:</span>
            <span class="n">util</span><span class="o">.</span><span class="n">log_msg</span><span class="p">(</span>
                <span class="sa">f</span><span class="s2">&quot;WARNING: target mode=</span><span class="si">{</span><span class="n">target_mode</span><span class="si">}</span><span class="s2">, switching from &quot;</span>
                <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">current_mode</span><span class="si">}</span><span class="s2"> to OFF_MODE to prevent damage to HVAC&quot;</span><span class="p">,</span>
                <span class="n">mode</span><span class="o">=</span><span class="n">util</span><span class="o">.</span><span class="n">BOTH_LOG</span><span class="p">,</span>
                <span class="n">func_name</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
            <span class="p">)</span>
            <span class="n">target_mode</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">OFF_MODE</span>

        <span class="c1"># revert the mode to target</span>
        <span class="c1"># UNKNOWN mode is bypassed</span>
        <span class="k">if</span> <span class="n">target_mode</span> <span class="o">==</span> <span class="bp">self</span><span class="o">.</span><span class="n">UNKNOWN_MODE</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">verbose</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span>
                <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">util</span><span class="o">.</span><span class="n">get_function_name</span><span class="p">()</span><span class="si">}</span><span class="s2">: target_mode=&#39;</span><span class="si">{</span><span class="n">target_mode</span><span class="si">}</span><span class="s2">&#39;, &quot;</span>
                <span class="s2">&quot;doing nothing.&quot;</span>
            <span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">set_mode</span><span class="p">(</span><span class="n">target_mode</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">target_mode</span></div>


<div class="viewcode-block" id="ThermostatCommonZone.measure_thermostat_repeatability">
<a class="viewcode-back" href="../../docs/thermostatsupervisor.html#thermostatsupervisor.thermostat_common.ThermostatCommonZone.measure_thermostat_repeatability">[docs]</a>
    <span class="k">def</span> <span class="nf">measure_thermostat_repeatability</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">measurements</span><span class="o">=</span><span class="mi">30</span><span class="p">,</span>
        <span class="n">poll_interval_sec</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span>
        <span class="n">func</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">measure_response_time</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
    <span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Measure Thermostat repeatability and report statistics.</span>

<span class="sd">        inputs:</span>
<span class="sd">            measurements(int): number of measurements</span>
<span class="sd">            poll_interval_sec(int): delay between measurements</span>
<span class="sd">            func(obj): target function to run during repeatabilty measurement.</span>
<span class="sd">            measure_response_time(bool): measure stats on response time instead</span>
<span class="sd">                                         of function.</span>
<span class="sd">        returns:</span>
<span class="sd">            (dict): measurement statistics.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">data_lst</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">stats</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="n">valid_datatypes</span> <span class="o">=</span> <span class="p">(</span><span class="nb">int</span><span class="p">,</span> <span class="nb">float</span><span class="p">)</span>
        <span class="c1"># set default measurement method if not provided.</span>
        <span class="k">if</span> <span class="n">func</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">func</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_display_temp</span>

        <span class="c1"># title message</span>
        <span class="k">if</span> <span class="n">poll_interval_sec</span> <span class="o">&gt;</span> <span class="mf">0.0</span><span class="p">:</span>
            <span class="n">delay_msg</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot; with </span><span class="si">{</span><span class="n">poll_interval_sec</span><span class="si">}</span><span class="s2"> sec. delay between measurements&quot;</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">delay_msg</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>
        <span class="nb">print</span><span class="p">(</span>
            <span class="sa">f</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">Thermostat response times for </span><span class="si">{</span><span class="n">measurements</span><span class="si">}</span><span class="s2"> measurements</span><span class="si">{</span><span class="n">delay_msg</span><span class="si">}</span><span class="s2">...&quot;</span>
        <span class="p">)</span>

        <span class="c1"># measurement loop</span>
        <span class="k">for</span> <span class="n">measurement</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">measurements</span><span class="p">):</span>
            <span class="n">t_start</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span>
            <span class="n">data</span> <span class="o">=</span> <span class="n">func</span><span class="p">()</span>  <span class="c1"># target command</span>
            <span class="n">t_end</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span>

            <span class="c1"># accumulate stats</span>
            <span class="n">tdelta</span> <span class="o">=</span> <span class="n">t_end</span> <span class="o">-</span> <span class="n">t_start</span>
            <span class="k">if</span> <span class="n">measure_response_time</span><span class="p">:</span>
                <span class="n">data_lst</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">tdelta</span><span class="p">)</span>
                <span class="n">measurement_display</span> <span class="o">=</span> <span class="n">tdelta</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="c1"># check for valid return type</span>
                <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">valid_datatypes</span><span class="p">):</span>
                    <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span>
                        <span class="sa">f</span><span class="s2">&quot;metric value=</span><span class="si">{</span><span class="n">data</span><span class="si">}</span><span class="s2">, data type=</span><span class="si">{</span><span class="nb">type</span><span class="p">(</span><span class="n">data</span><span class="p">)</span><span class="si">}</span><span class="s2">, the &quot;</span>
                        <span class="s2">&quot;metric repeatability assessment requires a &quot;</span>
                        <span class="s2">&quot;function that returns the metric of types &quot;</span>
                        <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">valid_datatypes</span><span class="si">}</span><span class="s2">&quot;</span>
                    <span class="p">)</span>
                <span class="n">data_lst</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
                <span class="n">measurement_display</span> <span class="o">=</span> <span class="n">data</span>
            <span class="n">util</span><span class="o">.</span><span class="n">log_msg</span><span class="p">(</span>
                <span class="sa">f</span><span class="s2">&quot;measurement </span><span class="si">{</span><span class="n">measurement</span><span class="si">}</span><span class="s2">=</span><span class="si">{</span><span class="n">measurement_display</span><span class="si">}</span><span class="s2"> &quot;</span>
                <span class="sa">f</span><span class="s2">&quot;(deltaTime=</span><span class="si">{</span><span class="n">tdelta</span><span class="si">:</span><span class="s2">.3f</span><span class="si">}</span><span class="s2"> sec, delay=</span><span class="si">{</span><span class="n">poll_interval_sec</span><span class="si">}</span><span class="s2"> sec)&quot;</span><span class="p">,</span>
                <span class="n">mode</span><span class="o">=</span><span class="n">util</span><span class="o">.</span><span class="n">BOTH_LOG</span><span class="p">,</span>
                <span class="n">func_name</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
            <span class="p">)</span>
            <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="n">poll_interval_sec</span><span class="p">)</span>

        <span class="c1"># calc stats</span>
        <span class="n">stats</span><span class="p">[</span><span class="s2">&quot;measurements&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">measurements</span>
        <span class="n">stats</span><span class="p">[</span><span class="s2">&quot;mean&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">round</span><span class="p">(</span><span class="n">statistics</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">data_lst</span><span class="p">),</span> <span class="mi">2</span><span class="p">)</span>
        <span class="n">stats</span><span class="p">[</span><span class="s2">&quot;stdev&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">round</span><span class="p">(</span><span class="n">statistics</span><span class="o">.</span><span class="n">stdev</span><span class="p">(</span><span class="n">data_lst</span><span class="p">),</span> <span class="mi">2</span><span class="p">)</span>
        <span class="n">stats</span><span class="p">[</span><span class="s2">&quot;min&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">round</span><span class="p">(</span><span class="nb">min</span><span class="p">(</span><span class="n">data_lst</span><span class="p">),</span> <span class="mi">2</span><span class="p">)</span>
        <span class="n">stats</span><span class="p">[</span><span class="s2">&quot;max&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">round</span><span class="p">(</span><span class="nb">max</span><span class="p">(</span><span class="n">data_lst</span><span class="p">),</span> <span class="mi">2</span><span class="p">)</span>
        <span class="n">stats</span><span class="p">[</span><span class="s2">&quot;3sigma_upper&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">round</span><span class="p">((</span><span class="mf">3.0</span> <span class="o">*</span> <span class="n">stats</span><span class="p">[</span><span class="s2">&quot;stdev&quot;</span><span class="p">]</span> <span class="o">+</span> <span class="n">stats</span><span class="p">[</span><span class="s2">&quot;mean&quot;</span><span class="p">]),</span> <span class="mi">2</span><span class="p">)</span>
        <span class="n">stats</span><span class="p">[</span><span class="s2">&quot;6sigma_upper&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">round</span><span class="p">((</span><span class="mf">6.0</span> <span class="o">*</span> <span class="n">stats</span><span class="p">[</span><span class="s2">&quot;stdev&quot;</span><span class="p">]</span> <span class="o">+</span> <span class="n">stats</span><span class="p">[</span><span class="s2">&quot;mean&quot;</span><span class="p">]),</span> <span class="mi">2</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">stats</span></div>


<div class="viewcode-block" id="ThermostatCommonZone.display_basic_thermostat_summary">
<a class="viewcode-back" href="../../docs/thermostatsupervisor.html#thermostatsupervisor.thermostat_common.ThermostatCommonZone.display_basic_thermostat_summary">[docs]</a>
    <span class="k">def</span> <span class="nf">display_basic_thermostat_summary</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">mode</span><span class="o">=</span><span class="n">util</span><span class="o">.</span><span class="n">STDOUT_LOG</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Display basic thermostat summary.</span>

<span class="sd">        inputs:</span>
<span class="sd">            mode(int): target log for data.</span>
<span class="sd">        returns:</span>
<span class="sd">            None, prints data to log and/or console.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="n">util</span><span class="o">.</span><span class="n">log_msg</span><span class="p">(</span><span class="s2">&quot;current thermostat settings...&quot;</span><span class="p">,</span> <span class="n">mode</span><span class="o">=</span><span class="n">mode</span><span class="p">,</span> <span class="n">func_name</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
        <span class="n">util</span><span class="o">.</span><span class="n">log_msg</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;zone name=&#39;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">zone_name</span><span class="si">}</span><span class="s2">&#39;&quot;</span><span class="p">,</span> <span class="n">mode</span><span class="o">=</span><span class="n">mode</span><span class="p">,</span> <span class="n">func_name</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
        <span class="n">sw_pos</span> <span class="o">=</span> <span class="n">util</span><span class="o">.</span><span class="n">get_key_from_value</span><span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">system_switch_position</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_system_switch_position</span><span class="p">()</span>
        <span class="p">)</span>
        <span class="n">util</span><span class="o">.</span><span class="n">log_msg</span><span class="p">(</span>
            <span class="sa">f</span><span class="s2">&quot;system switch position: </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">get_system_switch_position</span><span class="p">()</span><span class="si">}</span><span class="s2"> &quot;</span>
            <span class="sa">f</span><span class="s2">&quot;(</span><span class="si">{</span><span class="n">sw_pos</span><span class="si">}</span><span class="s2">)&quot;</span><span class="p">,</span>
            <span class="n">mode</span><span class="o">=</span><span class="n">mode</span><span class="p">,</span>
            <span class="n">func_name</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
        <span class="p">)</span>
        <span class="n">util</span><span class="o">.</span><span class="n">log_msg</span><span class="p">(</span>
            <span class="sa">f</span><span class="s2">&quot;thermostat display temp=&quot;</span>
            <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">util</span><span class="o">.</span><span class="n">temp_value_with_units</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">get_display_temp</span><span class="p">())</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span>
            <span class="n">mode</span><span class="o">=</span><span class="n">mode</span><span class="p">,</span>
            <span class="n">func_name</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
        <span class="p">)</span>
        <span class="n">util</span><span class="o">.</span><span class="n">log_msg</span><span class="p">(</span>
            <span class="sa">f</span><span class="s2">&quot;thermostat display humidity=&quot;</span>
            <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">util</span><span class="o">.</span><span class="n">humidity_value_with_units</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">get_display_humidity</span><span class="p">())</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span>
            <span class="n">mode</span><span class="o">=</span><span class="n">mode</span><span class="p">,</span>
            <span class="n">func_name</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
        <span class="p">)</span>
        <span class="n">util</span><span class="o">.</span><span class="n">log_msg</span><span class="p">(</span>
            <span class="sa">f</span><span class="s2">&quot;heat set point=&quot;</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">get_heat_setpoint</span><span class="p">()</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span>
            <span class="n">mode</span><span class="o">=</span><span class="n">mode</span><span class="p">,</span>
            <span class="n">func_name</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
        <span class="p">)</span>
        <span class="n">util</span><span class="o">.</span><span class="n">log_msg</span><span class="p">(</span>
            <span class="sa">f</span><span class="s2">&quot;cool set point=&quot;</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">get_cool_setpoint</span><span class="p">()</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span>
            <span class="n">mode</span><span class="o">=</span><span class="n">mode</span><span class="p">,</span>
            <span class="n">func_name</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
        <span class="p">)</span>
        <span class="n">util</span><span class="o">.</span><span class="n">log_msg</span><span class="p">(</span>
            <span class="sa">f</span><span class="s2">&quot;heat schedule set point=&quot;</span>
            <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">util</span><span class="o">.</span><span class="n">temp_value_with_units</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">get_schedule_heat_sp</span><span class="p">())</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span>
            <span class="n">mode</span><span class="o">=</span><span class="n">mode</span><span class="p">,</span>
            <span class="n">func_name</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
        <span class="p">)</span>
        <span class="n">util</span><span class="o">.</span><span class="n">log_msg</span><span class="p">(</span>
            <span class="sa">f</span><span class="s2">&quot;cool schedule set point=&quot;</span>
            <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">util</span><span class="o">.</span><span class="n">temp_value_with_units</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">get_schedule_cool_sp</span><span class="p">())</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span>
            <span class="n">mode</span><span class="o">=</span><span class="n">mode</span><span class="p">,</span>
            <span class="n">func_name</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
        <span class="p">)</span>
        <span class="n">util</span><span class="o">.</span><span class="n">log_msg</span><span class="p">(</span>
            <span class="sa">f</span><span class="s2">&quot;(schedule) heat program=</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">get_schedule_program_heat</span><span class="p">()</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span>
            <span class="n">mode</span><span class="o">=</span><span class="n">mode</span><span class="p">,</span>
            <span class="n">func_name</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
        <span class="p">)</span>
        <span class="n">util</span><span class="o">.</span><span class="n">log_msg</span><span class="p">(</span>
            <span class="sa">f</span><span class="s2">&quot;(schedule) cool program=</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">get_schedule_program_cool</span><span class="p">()</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span>
            <span class="n">mode</span><span class="o">=</span><span class="n">mode</span><span class="p">,</span>
            <span class="n">func_name</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
        <span class="p">)</span>
        <span class="n">util</span><span class="o">.</span><span class="n">log_msg</span><span class="p">(</span>
            <span class="sa">f</span><span class="s2">&quot;heat mode=</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">is_heat_mode</span><span class="p">()</span><span class="si">}</span><span class="s2"> &quot;</span>
            <span class="sa">f</span><span class="s2">&quot;(actively heating=</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">is_heating</span><span class="p">()</span><span class="si">}</span><span class="s2">)&quot;</span><span class="p">,</span>
            <span class="n">mode</span><span class="o">=</span><span class="n">mode</span><span class="p">,</span>
            <span class="n">func_name</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
        <span class="p">)</span>
        <span class="n">util</span><span class="o">.</span><span class="n">log_msg</span><span class="p">(</span>
            <span class="sa">f</span><span class="s2">&quot;cool mode=</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">is_cool_mode</span><span class="p">()</span><span class="si">}</span><span class="s2"> &quot;</span>
            <span class="sa">f</span><span class="s2">&quot;(actively cooling=</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">is_cooling</span><span class="p">()</span><span class="si">}</span><span class="s2">)&quot;</span><span class="p">,</span>
            <span class="n">mode</span><span class="o">=</span><span class="n">mode</span><span class="p">,</span>
            <span class="n">func_name</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
        <span class="p">)</span>
        <span class="n">util</span><span class="o">.</span><span class="n">log_msg</span><span class="p">(</span>
            <span class="sa">f</span><span class="s2">&quot;dry mode=</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">is_dry_mode</span><span class="p">()</span><span class="si">}</span><span class="s2"> &quot;</span> <span class="sa">f</span><span class="s2">&quot;(actively drying=</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">is_drying</span><span class="p">()</span><span class="si">}</span><span class="s2">)&quot;</span><span class="p">,</span>
            <span class="n">mode</span><span class="o">=</span><span class="n">mode</span><span class="p">,</span>
            <span class="n">func_name</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
        <span class="p">)</span>
        <span class="n">util</span><span class="o">.</span><span class="n">log_msg</span><span class="p">(</span>
            <span class="sa">f</span><span class="s2">&quot;auto mode=</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">is_auto_mode</span><span class="p">()</span><span class="si">}</span><span class="s2"> &quot;</span> <span class="sa">f</span><span class="s2">&quot;(actively auto=</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">is_auto</span><span class="p">()</span><span class="si">}</span><span class="s2">)&quot;</span><span class="p">,</span>
            <span class="n">mode</span><span class="o">=</span><span class="n">mode</span><span class="p">,</span>
            <span class="n">func_name</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
        <span class="p">)</span>
        <span class="n">util</span><span class="o">.</span><span class="n">log_msg</span><span class="p">(</span>
            <span class="sa">f</span><span class="s2">&quot;fan mode=</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">is_fan_mode</span><span class="p">()</span><span class="si">}</span><span class="s2"> &quot;</span> <span class="sa">f</span><span class="s2">&quot;(actively fanning=</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">is_fanning</span><span class="p">()</span><span class="si">}</span><span class="s2">)&quot;</span><span class="p">,</span>
            <span class="n">mode</span><span class="o">=</span><span class="n">mode</span><span class="p">,</span>
            <span class="n">func_name</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
        <span class="p">)</span>
        <span class="n">util</span><span class="o">.</span><span class="n">log_msg</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;off mode=</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">is_off_mode</span><span class="p">()</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">mode</span><span class="o">=</span><span class="n">mode</span><span class="p">,</span> <span class="n">func_name</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
        <span class="n">util</span><span class="o">.</span><span class="n">log_msg</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;hold=</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">get_vacation_hold</span><span class="p">()</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">mode</span><span class="o">=</span><span class="n">mode</span><span class="p">,</span> <span class="n">func_name</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
        <span class="n">util</span><span class="o">.</span><span class="n">log_msg</span><span class="p">(</span>
            <span class="sa">f</span><span class="s2">&quot;temporary hold minutes=</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">get_temporary_hold_until_time</span><span class="p">()</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span>
            <span class="n">mode</span><span class="o">=</span><span class="n">mode</span><span class="p">,</span>
            <span class="n">func_name</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
        <span class="p">)</span></div>


<div class="viewcode-block" id="ThermostatCommonZone.revert_temperature_deviation">
<a class="viewcode-back" href="../../docs/thermostatsupervisor.html#thermostatsupervisor.thermostat_common.ThermostatCommonZone.revert_temperature_deviation">[docs]</a>
    <span class="k">def</span> <span class="nf">revert_temperature_deviation</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">setpoint</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">msg</span><span class="o">=</span><span class="s2">&quot;&quot;</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Revert the temperature deviation.</span>

<span class="sd">        inputs:</span>
<span class="sd">            setpoint(int or float): setpoint in °F</span>
<span class="sd">            msg(str): status message to display.</span>
<span class="sd">        returns:</span>
<span class="sd">            None</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">setpoint</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">setpoint</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">current_setpoint</span>

        <span class="n">eml</span><span class="o">.</span><span class="n">send_email_alert</span><span class="p">(</span>
            <span class="n">subject</span><span class="o">=</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">thermostat_type</span><span class="si">}</span><span class="s2"> </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">current_mode</span><span class="o">.</span><span class="n">upper</span><span class="p">()</span><span class="si">}</span><span class="s2"> &quot;</span>
            <span class="sa">f</span><span class="s2">&quot;deviation alert on zone </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">zone_name</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span>
            <span class="n">body</span><span class="o">=</span><span class="n">msg</span><span class="p">,</span>
        <span class="p">)</span>
        <span class="n">util</span><span class="o">.</span><span class="n">log_msg</span><span class="p">(</span>
            <span class="sa">f</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">*** </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">thermostat_type</span><span class="si">}</span><span class="s2"> </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">current_mode</span><span class="o">.</span><span class="n">upper</span><span class="p">()</span><span class="si">}</span><span class="s2"> &quot;</span>
            <span class="sa">f</span><span class="s2">&quot;deviation detected on zone </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">zone_name</span><span class="si">}</span><span class="s2">, &quot;</span>
            <span class="sa">f</span><span class="s2">&quot;reverting thermostat to heat schedule ***</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">,</span>
            <span class="n">mode</span><span class="o">=</span><span class="n">util</span><span class="o">.</span><span class="n">BOTH_LOG</span><span class="p">,</span>
        <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">revert_setpoint_func</span><span class="p">(</span><span class="n">setpoint</span><span class="p">)</span></div>


<div class="viewcode-block" id="ThermostatCommonZone.function_not_supported">
<a class="viewcode-back" href="../../docs/thermostatsupervisor.html#thermostatsupervisor.thermostat_common.ThermostatCommonZone.function_not_supported">[docs]</a>
    <span class="k">def</span> <span class="nf">function_not_supported</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">_</span><span class="p">,</span> <span class="o">**</span><span class="n">__</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Function for unsupported activities.&quot;&quot;&quot;</span>
        <span class="n">util</span><span class="o">.</span><span class="n">log_msg</span><span class="p">(</span>
            <span class="sa">f</span><span class="s2">&quot;WARNING (in </span><span class="si">{</span><span class="n">util</span><span class="o">.</span><span class="n">get_function_name</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span><span class="si">}</span><span class="s2">): function call is &quot;</span>
            <span class="sa">f</span><span class="s2">&quot;not supported on this thermostat type&quot;</span><span class="p">,</span>
            <span class="n">mode</span><span class="o">=</span><span class="n">util</span><span class="o">.</span><span class="n">BOTH_LOG</span><span class="p">,</span>
        <span class="p">)</span></div>


<div class="viewcode-block" id="ThermostatCommonZone.display_runtime_settings">
<a class="viewcode-back" href="../../docs/thermostatsupervisor.html#thermostatsupervisor.thermostat_common.ThermostatCommonZone.display_runtime_settings">[docs]</a>
    <span class="k">def</span> <span class="nf">display_runtime_settings</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Display runtime settings to console.</span>

<span class="sd">        inputs:</span>
<span class="sd">            None</span>
<span class="sd">        returns:</span>
<span class="sd">            None</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># poll time setting:</span>
        <span class="n">util</span><span class="o">.</span><span class="n">log_msg</span><span class="p">(</span>
            <span class="sa">f</span><span class="s2">&quot;polling time set to </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">poll_time_sec</span><span class="w"> </span><span class="o">/</span><span class="w"> </span><span class="mf">60.0</span><span class="si">:</span><span class="s2">.1f</span><span class="si">}</span><span class="s2"> minutes&quot;</span><span class="p">,</span>
            <span class="n">mode</span><span class="o">=</span><span class="n">util</span><span class="o">.</span><span class="n">BOTH_LOG</span><span class="p">,</span>
        <span class="p">)</span>

        <span class="c1"># reconnection time to thermostat server:</span>
        <span class="n">util</span><span class="o">.</span><span class="n">log_msg</span><span class="p">(</span>
            <span class="sa">f</span><span class="s2">&quot;server re-connect time set to &quot;</span>
            <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">connection_time_sec</span><span class="w"> </span><span class="o">/</span><span class="w"> </span><span class="mf">60.0</span><span class="si">:</span><span class="s2">.1f</span><span class="si">}</span><span class="s2">&quot;</span>
            <span class="sa">f</span><span class="s2">&quot; minutes&quot;</span><span class="p">,</span>
            <span class="n">mode</span><span class="o">=</span><span class="n">util</span><span class="o">.</span><span class="n">BOTH_LOG</span><span class="p">,</span>
        <span class="p">)</span>

        <span class="c1"># tolerance to set point:</span>
        <span class="n">util</span><span class="o">.</span><span class="n">log_msg</span><span class="p">(</span>
            <span class="sa">f</span><span class="s2">&quot;tolerance to set point is set to &quot;</span>
            <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">util</span><span class="o">.</span><span class="n">temp_value_with_units</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">tolerance_degrees</span><span class="p">,</span><span class="w"> </span><span class="n">precision</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span>
            <span class="n">mode</span><span class="o">=</span><span class="n">util</span><span class="o">.</span><span class="n">BOTH_LOG</span><span class="p">,</span>
        <span class="p">)</span></div>


<div class="viewcode-block" id="ThermostatCommonZone.display_session_settings">
<a class="viewcode-back" href="../../docs/thermostatsupervisor.html#thermostatsupervisor.thermostat_common.ThermostatCommonZone.display_session_settings">[docs]</a>
    <span class="k">def</span> <span class="nf">display_session_settings</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Display session settings to console.</span>

<span class="sd">        inputs:</span>
<span class="sd">            None</span>
<span class="sd">        returns:</span>
<span class="sd">            None</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># set log file name</span>
        <span class="n">util</span><span class="o">.</span><span class="n">log_msg</span><span class="o">.</span><span class="n">file_name</span> <span class="o">=</span> <span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">thermostat_type</span> <span class="o">+</span> <span class="s2">&quot;_&quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">zone_name</span><span class="p">)</span> <span class="o">+</span> <span class="s2">&quot;.txt&quot;</span>
        <span class="p">)</span>

        <span class="n">util</span><span class="o">.</span><span class="n">log_msg</span><span class="p">(</span>
            <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">thermostat_type</span><span class="si">}</span><span class="s2"> thermostat zone </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">zone_name</span><span class="si">}</span><span class="s2"> &quot;</span>
            <span class="sa">f</span><span class="s2">&quot;monitoring service</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">,</span>
            <span class="n">mode</span><span class="o">=</span><span class="n">util</span><span class="o">.</span><span class="n">BOTH_LOG</span><span class="p">,</span>
        <span class="p">)</span>

        <span class="n">util</span><span class="o">.</span><span class="n">log_msg</span><span class="p">(</span><span class="s2">&quot;session settings:&quot;</span><span class="p">,</span> <span class="n">mode</span><span class="o">=</span><span class="n">util</span><span class="o">.</span><span class="n">BOTH_LOG</span><span class="p">)</span>

        <span class="n">util</span><span class="o">.</span><span class="n">log_msg</span><span class="p">(</span>
            <span class="s2">&quot;thermostat </span><span class="si">%s</span><span class="s2"> for </span><span class="si">%s</span><span class="se">\n</span><span class="s2">&quot;</span>
            <span class="o">%</span> <span class="p">(</span>
                <span class="p">[</span><span class="s2">&quot;is being monitored&quot;</span><span class="p">,</span> <span class="s2">&quot;will be reverted&quot;</span><span class="p">][</span><span class="bp">self</span><span class="o">.</span><span class="n">revert_deviations</span><span class="p">],</span>
                <span class="p">[</span>
                    <span class="s2">&quot;energy consuming deviations</span><span class="se">\n</span><span class="s2">(&quot;</span>
                    <span class="s2">&quot;e.g. heat setpoint above schedule &quot;</span>
                    <span class="s2">&quot;setpoint, cool setpoint below schedule&quot;</span>
                    <span class="s2">&quot; setpoint)&quot;</span><span class="p">,</span>
                    <span class="s2">&quot;all schedule deviations&quot;</span><span class="p">,</span>
                <span class="p">][</span><span class="bp">self</span><span class="o">.</span><span class="n">revert_all_deviations</span><span class="p">],</span>
            <span class="p">),</span>
            <span class="n">mode</span><span class="o">=</span><span class="n">util</span><span class="o">.</span><span class="n">BOTH_LOG</span><span class="p">,</span>
        <span class="p">)</span></div>


<div class="viewcode-block" id="ThermostatCommonZone.supervisor_loop">
<a class="viewcode-back" href="../../docs/thermostatsupervisor.html#thermostatsupervisor.thermostat_common.ThermostatCommonZone.supervisor_loop">[docs]</a>
    <span class="k">def</span> <span class="nf">supervisor_loop</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">Thermostat</span><span class="p">,</span> <span class="n">session_count</span><span class="p">,</span> <span class="n">measurement</span><span class="p">,</span> <span class="n">debug</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Loop through supervisor algorithm.</span>

<span class="sd">        inputs:</span>
<span class="sd">            Thermostat(obj):  Thermostat instance object</span>
<span class="sd">            session_count(int):  current session</span>
<span class="sd">            measurement(int):  current measurement index</span>
<span class="sd">            debug(bool): debug flag</span>
<span class="sd">        returns:</span>
<span class="sd">            measurement(int): current measurement count</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">global</span> <span class="n">connection_ok</span>  <span class="c1"># noqa W603</span>

        <span class="c1"># initialize poll counter</span>
        <span class="n">poll_count</span> <span class="o">=</span> <span class="mi">1</span>
        <span class="n">previous_mode_dict</span> <span class="o">=</span> <span class="p">{}</span>

        <span class="c1"># poll thermostat settings</span>
        <span class="k">while</span> <span class="ow">not</span> <span class="n">api</span><span class="o">.</span><span class="n">uip</span><span class="o">.</span><span class="n">max_measurement_count_exceeded</span><span class="p">(</span><span class="n">measurement</span><span class="p">):</span>
            <span class="c1"># query thermostat for current settings and set points</span>
            <span class="n">current_mode_dict</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_current_mode</span><span class="p">(</span>
                <span class="n">session_count</span><span class="p">,</span>
                <span class="n">poll_count</span><span class="p">,</span>
                <span class="n">flag_all_deviations</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">revert_all_deviations</span><span class="p">,</span>
            <span class="p">)</span>

            <span class="c1"># debug data on change from previous poll</span>
            <span class="c1"># note this check is probably hyper-sensitive, since status msg</span>
            <span class="c1"># change could trigger this extra report.</span>
            <span class="k">if</span> <span class="n">current_mode_dict</span> <span class="o">!=</span> <span class="n">previous_mode_dict</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">debug</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">report_heating_parameters</span><span class="p">()</span>
                <span class="n">previous_mode_dict</span> <span class="o">=</span> <span class="n">current_mode_dict</span>  <span class="c1"># latch</span>

            <span class="c1"># revert thermostat mode if not matching target</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">verify_current_mode</span><span class="p">(</span>
                <span class="n">api</span><span class="o">.</span><span class="n">uip</span><span class="o">.</span><span class="n">get_user_inputs</span><span class="p">(</span><span class="n">api</span><span class="o">.</span><span class="n">uip</span><span class="o">.</span><span class="n">zone_name</span><span class="p">,</span> <span class="n">api</span><span class="o">.</span><span class="n">input_flds</span><span class="o">.</span><span class="n">target_mode</span><span class="p">)</span>
            <span class="p">):</span>
                <span class="n">api</span><span class="o">.</span><span class="n">uip</span><span class="o">.</span><span class="n">set_user_inputs</span><span class="p">(</span>
                    <span class="n">api</span><span class="o">.</span><span class="n">uip</span><span class="o">.</span><span class="n">zone_name</span><span class="p">,</span>
                    <span class="n">api</span><span class="o">.</span><span class="n">input_flds</span><span class="o">.</span><span class="n">target_mode</span><span class="p">,</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">revert_thermostat_mode</span><span class="p">(</span>
                        <span class="n">api</span><span class="o">.</span><span class="n">uip</span><span class="o">.</span><span class="n">get_user_inputs</span><span class="p">(</span>
                            <span class="n">api</span><span class="o">.</span><span class="n">uip</span><span class="o">.</span><span class="n">zone_name</span><span class="p">,</span> <span class="n">api</span><span class="o">.</span><span class="n">input_flds</span><span class="o">.</span><span class="n">target_mode</span>
                        <span class="p">)</span>
                    <span class="p">),</span>
                <span class="p">)</span>

            <span class="c1"># revert thermostat to schedule if heat override is detected</span>
            <span class="k">if</span> <span class="p">(</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">revert_deviations</span>
                <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">is_controlled_mode</span><span class="p">()</span>
                <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">is_temp_deviated_from_schedule</span><span class="p">()</span>
            <span class="p">):</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">revert_temperature_deviation</span><span class="p">(</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">schedule_setpoint</span><span class="p">,</span> <span class="n">current_mode_dict</span><span class="p">[</span><span class="s2">&quot;status_msg&quot;</span><span class="p">]</span>
                <span class="p">)</span>

            <span class="c1"># increment poll count</span>
            <span class="n">poll_count</span> <span class="o">+=</span> <span class="mi">1</span>
            <span class="n">measurement</span> <span class="o">+=</span> <span class="mi">1</span>

            <span class="c1"># polling delay</span>
            <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">poll_time_sec</span><span class="p">)</span>

            <span class="c1"># refresh zone info</span>
            <span class="n">connection_ok</span> <span class="o">=</span> <span class="kc">True</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">refresh_zone_info</span><span class="p">()</span>

            <span class="c1"># reconnect</span>
            <span class="k">if</span> <span class="p">(</span>
                <span class="p">(</span><span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">session_start_time_sec</span><span class="p">)</span> <span class="o">&gt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">connection_time_sec</span>
            <span class="p">)</span> <span class="ow">or</span> <span class="ow">not</span> <span class="n">connection_ok</span><span class="p">:</span>
                <span class="n">util</span><span class="o">.</span><span class="n">log_msg</span><span class="p">(</span>
                    <span class="s2">&quot;forcing re-connection to thermostat...&quot;</span><span class="p">,</span> <span class="n">mode</span><span class="o">=</span><span class="n">util</span><span class="o">.</span><span class="n">BOTH_LOG</span>
                <span class="p">)</span>
                <span class="k">del</span> <span class="n">Thermostat</span>
                <span class="k">break</span>  <span class="c1"># force reconnection</span>

        <span class="c1"># return measurement count</span>
        <span class="k">return</span> <span class="n">measurement</span></div>
</div>



<div class="viewcode-block" id="create_thermostat_instance">
<a class="viewcode-back" href="../../docs/thermostatsupervisor.html#thermostatsupervisor.thermostat_common.create_thermostat_instance">[docs]</a>
<span class="k">def</span> <span class="nf">create_thermostat_instance</span><span class="p">(</span>
    <span class="n">thermostat_type</span><span class="p">,</span> <span class="n">zone</span><span class="p">,</span> <span class="n">ThermostatClass</span><span class="p">,</span> <span class="n">ThermostatZone</span><span class="p">,</span> <span class="n">verbose</span><span class="o">=</span><span class="kc">True</span>
<span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Create Thermostat and Zone instances.</span>

<span class="sd">    inputs:</span>
<span class="sd">        tstat(int):  thermostat_type</span>
<span class="sd">        zone(int): zone number</span>
<span class="sd">        zone_name(str): name of zone</span>
<span class="sd">        ThermostatClass(cls): Thermostat class</span>
<span class="sd">        ThermostatZone(cls): ThermostatZone class</span>
<span class="sd">        verbose(bool): debug flag</span>
<span class="sd">    returns:</span>
<span class="sd">        Thermostat(obj): Thermostat object</span>
<span class="sd">        Zone(obj):  Zone object</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">util</span><span class="o">.</span><span class="n">log_msg</span><span class="o">.</span><span class="n">debug</span> <span class="o">=</span> <span class="n">verbose</span>  <span class="c1"># debug mode set</span>

    <span class="c1"># verify required env vars</span>
    <span class="n">api</span><span class="o">.</span><span class="n">verify_required_env_variables</span><span class="p">(</span><span class="n">thermostat_type</span><span class="p">,</span> <span class="nb">str</span><span class="p">(</span><span class="n">zone</span><span class="p">),</span> <span class="n">verbose</span><span class="o">=</span><span class="n">verbose</span><span class="p">)</span>

    <span class="c1"># import hardware module</span>
    <span class="n">api</span><span class="o">.</span><span class="n">load_hardware_library</span><span class="p">(</span><span class="n">thermostat_type</span><span class="p">)</span>

    <span class="c1"># create Thermostat object</span>
    <span class="n">Thermostat</span> <span class="o">=</span> <span class="n">ThermostatClass</span><span class="p">(</span><span class="n">zone</span><span class="p">,</span> <span class="n">verbose</span><span class="o">=</span><span class="n">verbose</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">verbose</span><span class="p">:</span>
        <span class="n">Thermostat</span><span class="o">.</span><span class="n">print_all_thermostat_metadata</span><span class="p">(</span><span class="n">zone</span><span class="p">)</span>

    <span class="c1"># create Zone object</span>
    <span class="n">Zone</span> <span class="o">=</span> <span class="n">ThermostatZone</span><span class="p">(</span><span class="n">Thermostat</span><span class="p">,</span> <span class="n">verbose</span><span class="o">=</span><span class="n">verbose</span><span class="p">)</span>

    <span class="c1"># update runtime overrides</span>
    <span class="c1"># thermostat_type</span>
    <span class="n">api</span><span class="o">.</span><span class="n">uip</span><span class="o">.</span><span class="n">set_user_inputs</span><span class="p">(</span>
        <span class="n">api</span><span class="o">.</span><span class="n">uip</span><span class="o">.</span><span class="n">zone_name</span><span class="p">,</span> <span class="n">api</span><span class="o">.</span><span class="n">input_flds</span><span class="o">.</span><span class="n">thermostat_type</span><span class="p">,</span> <span class="n">thermostat_type</span>
    <span class="p">)</span>
    <span class="c1"># zone</span>
    <span class="n">api</span><span class="o">.</span><span class="n">uip</span><span class="o">.</span><span class="n">set_user_inputs</span><span class="p">(</span><span class="n">api</span><span class="o">.</span><span class="n">uip</span><span class="o">.</span><span class="n">zone_name</span><span class="p">,</span> <span class="n">api</span><span class="o">.</span><span class="n">input_flds</span><span class="o">.</span><span class="n">zone</span><span class="p">,</span> <span class="n">zone</span><span class="p">)</span>
    <span class="n">Zone</span><span class="o">.</span><span class="n">update_runtime_parameters</span><span class="p">()</span>

    <span class="k">return</span> <span class="n">Thermostat</span><span class="p">,</span> <span class="n">Zone</span></div>



<div class="viewcode-block" id="thermostat_basic_checkout">
<a class="viewcode-back" href="../../docs/thermostatsupervisor.html#thermostatsupervisor.thermostat_common.thermostat_basic_checkout">[docs]</a>
<span class="k">def</span> <span class="nf">thermostat_basic_checkout</span><span class="p">(</span><span class="n">thermostat_type</span><span class="p">,</span> <span class="n">zone</span><span class="p">,</span> <span class="n">ThermostatClass</span><span class="p">,</span> <span class="n">ThermostatZone</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Perform basic Thermostat checkout.</span>

<span class="sd">    inputs:</span>
<span class="sd">        tstat(int):  thermostat_type</span>
<span class="sd">        zone(int): zone number</span>
<span class="sd">        ThermostatClass(cls): Thermostat class</span>
<span class="sd">        ThermostatZone(cls): ThermostatZone class</span>
<span class="sd">    returns:</span>
<span class="sd">        Thermostat(obj): Thermostat object</span>
<span class="sd">        Zone(obj):  Zone object</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">util</span><span class="o">.</span><span class="n">log_msg</span><span class="o">.</span><span class="n">debug</span> <span class="o">=</span> <span class="kc">True</span>  <span class="c1"># debug mode set</span>

    <span class="c1"># create class instances</span>
    <span class="n">Thermostat</span><span class="p">,</span> <span class="n">Zone</span> <span class="o">=</span> <span class="n">create_thermostat_instance</span><span class="p">(</span>
        <span class="n">thermostat_type</span><span class="p">,</span> <span class="n">zone</span><span class="p">,</span> <span class="n">ThermostatClass</span><span class="p">,</span> <span class="n">ThermostatZone</span>
    <span class="p">)</span>

    <span class="n">Zone</span><span class="o">.</span><span class="n">display_basic_thermostat_summary</span><span class="p">()</span>

    <span class="k">return</span> <span class="n">Thermostat</span><span class="p">,</span> <span class="n">Zone</span></div>



<div class="viewcode-block" id="get_wifi_status_display">
<a class="viewcode-back" href="../../docs/thermostatsupervisor.html#thermostatsupervisor.thermostat_common.get_wifi_status_display">[docs]</a>
<span class="k">def</span> <span class="nf">get_wifi_status_display</span><span class="p">(</span><span class="n">wifi_status</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Return string to display based on wifi status.</span>

<span class="sd">    inputs:</span>
<span class="sd">        wifi_status(bool, float, None): wifi status.</span>
<span class="sd">    returns:</span>
<span class="sd">        (str): wifi status</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">wifi_status_display_dict</span> <span class="o">=</span> <span class="p">{</span>
        <span class="kc">False</span><span class="p">:</span> <span class="s2">&quot;weak&quot;</span><span class="p">,</span>
        <span class="kc">True</span><span class="p">:</span> <span class="s2">&quot;ok&quot;</span><span class="p">,</span>
    <span class="p">}</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">wifi_status_display_dict</span><span class="p">[</span><span class="n">wifi_status</span><span class="p">]</span>
    <span class="k">except</span> <span class="ne">KeyError</span><span class="p">:</span>
        <span class="k">return</span> <span class="s2">&quot;unknown&quot;</span></div>



<div class="viewcode-block" id="get_battery_status_display">
<a class="viewcode-back" href="../../docs/thermostatsupervisor.html#thermostatsupervisor.thermostat_common.get_battery_status_display">[docs]</a>
<span class="k">def</span> <span class="nf">get_battery_status_display</span><span class="p">(</span><span class="n">battery_status</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Return string to display based on battery status.</span>

<span class="sd">    inputs:</span>
<span class="sd">        wifi_status(bool, float, None): wifi status.</span>
<span class="sd">    returns:</span>
<span class="sd">        (str): wifi status</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">battery_status_display_dict</span> <span class="o">=</span> <span class="p">{</span>
        <span class="kc">False</span><span class="p">:</span> <span class="s2">&quot;bad&quot;</span><span class="p">,</span>
        <span class="kc">True</span><span class="p">:</span> <span class="s2">&quot;ok&quot;</span><span class="p">,</span>
    <span class="p">}</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">battery_status_display_dict</span><span class="p">[</span><span class="n">battery_status</span><span class="p">]</span>
    <span class="k">except</span> <span class="ne">KeyError</span><span class="p">:</span>
        <span class="k">return</span> <span class="s2">&quot;unknown&quot;</span></div>



<div class="viewcode-block" id="print_select_data_from_all_zones">
<a class="viewcode-back" href="../../docs/thermostatsupervisor.html#thermostatsupervisor.thermostat_common.print_select_data_from_all_zones">[docs]</a>
<span class="k">def</span> <span class="nf">print_select_data_from_all_zones</span><span class="p">(</span>
    <span class="n">thermostat_type</span><span class="p">,</span>
    <span class="n">zone_lst</span><span class="p">,</span>
    <span class="n">ThermostatClass</span><span class="p">,</span>
    <span class="n">ThermostatZone</span><span class="p">,</span>
    <span class="n">display_wifi</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
    <span class="n">display_battery</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
<span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Cycle through all zones and print out select data.</span>

<span class="sd">    inputs:</span>
<span class="sd">        tstat(int):  thermostat_type</span>
<span class="sd">        zone_lst(list): list of zones</span>
<span class="sd">        ThermostatClass(cls): Thermostat class</span>
<span class="sd">        ThermostatZone(cls): ThermostatZone class</span>
<span class="sd">        display_wifi(bool): display wifi status</span>
<span class="sd">        display_battery(bool): display battery status</span>
<span class="sd">    returns:</span>
<span class="sd">        Thermostat(obj): Thermostat object</span>
<span class="sd">        Zone(obj):  Zone object</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">util</span><span class="o">.</span><span class="n">log_msg</span><span class="o">.</span><span class="n">debug</span> <span class="o">=</span> <span class="kc">False</span>  <span class="c1"># debug mode unset</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">querying select data for all zones:&quot;</span><span class="p">)</span>

    <span class="k">for</span> <span class="n">zone</span> <span class="ow">in</span> <span class="n">zone_lst</span><span class="p">:</span>
        <span class="c1"># create class instances</span>
        <span class="n">Thermostat</span><span class="p">,</span> <span class="n">Zone</span> <span class="o">=</span> <span class="n">create_thermostat_instance</span><span class="p">(</span>
            <span class="n">thermostat_type</span><span class="p">,</span> <span class="n">zone</span><span class="p">,</span> <span class="n">ThermostatClass</span><span class="p">,</span> <span class="n">ThermostatZone</span><span class="p">,</span> <span class="n">verbose</span><span class="o">=</span><span class="kc">False</span>
        <span class="p">)</span>
        <span class="c1"># zone temperature</span>
        <span class="n">display_temp</span> <span class="o">=</span> <span class="n">Zone</span><span class="o">.</span><span class="n">get_display_temp</span><span class="p">()</span>
        <span class="n">msg</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;zone: </span><span class="si">{</span><span class="n">zone</span><span class="si">}</span><span class="s2">, name: </span><span class="si">{</span><span class="n">Zone</span><span class="o">.</span><span class="n">zone_name</span><span class="si">}</span><span class="s2">, temp: &quot;</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">display_temp</span><span class="si">:</span><span class="s2">.1f</span><span class="si">}</span><span class="s2"> °F&quot;</span>

        <span class="c1"># zone wifi strength</span>
        <span class="k">if</span> <span class="n">display_wifi</span><span class="p">:</span>
            <span class="n">wifi_strength</span> <span class="o">=</span> <span class="n">Zone</span><span class="o">.</span><span class="n">get_wifi_strength</span><span class="p">()</span>
            <span class="n">wifi_status</span> <span class="o">=</span> <span class="n">Zone</span><span class="o">.</span><span class="n">get_wifi_status</span><span class="p">()</span>
            <span class="n">wifi_status_display</span> <span class="o">=</span> <span class="n">get_wifi_status_display</span><span class="p">(</span><span class="n">wifi_status</span><span class="p">)</span>
            <span class="n">msg</span> <span class="o">+=</span> <span class="sa">f</span><span class="s2">&quot;, wifi strength: </span><span class="si">{</span><span class="n">wifi_strength</span><span class="si">}</span><span class="s2"> dBm &quot;</span> <span class="sa">f</span><span class="s2">&quot;(</span><span class="si">{</span><span class="n">wifi_status_display</span><span class="si">}</span><span class="s2">)&quot;</span>

        <span class="c1"># zone battery stats</span>
        <span class="k">if</span> <span class="n">display_battery</span><span class="p">:</span>
            <span class="n">battery_voltage</span> <span class="o">=</span> <span class="n">Zone</span><span class="o">.</span><span class="n">get_battery_voltage</span><span class="p">()</span>
            <span class="n">battery_status</span> <span class="o">=</span> <span class="n">Zone</span><span class="o">.</span><span class="n">get_battery_status</span><span class="p">()</span>
            <span class="n">battery_status_display</span> <span class="o">=</span> <span class="n">get_battery_status_display</span><span class="p">(</span><span class="n">battery_status</span><span class="p">)</span>
            <span class="n">msg</span> <span class="o">+=</span> <span class="p">(</span>
                <span class="sa">f</span><span class="s2">&quot;, battery voltage: </span><span class="si">{</span><span class="n">battery_voltage</span><span class="si">:</span><span class="s2">.2f</span><span class="si">}</span><span class="s2"> volts &quot;</span>
                <span class="sa">f</span><span class="s2">&quot;(</span><span class="si">{</span><span class="n">battery_status_display</span><span class="si">}</span><span class="s2">)&quot;</span>
            <span class="p">)</span>

        <span class="nb">print</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">Thermostat</span><span class="p">,</span> <span class="n">Zone</span></div>



<div class="viewcode-block" id="AuthenticationError">
<a class="viewcode-back" href="../../docs/thermostatsupervisor.html#thermostatsupervisor.thermostat_common.AuthenticationError">[docs]</a>
<span class="k">class</span> <span class="nc">AuthenticationError</span><span class="p">(</span><span class="ne">ValueError</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;denoted if we are completely unable to authenticate.&quot;&quot;&quot;</span>

    <span class="k">pass</span></div>

</pre></div>

          </div>
          
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="Main">
        <div class="sphinxsidebarwrapper">
<h1 class="logo"><a href="../../index.html">ThermostatSupervisor</a></h1>









<search id="searchbox" style="display: none" role="search">
    <div class="searchformwrapper">
    <form class="search" action="../../search.html" method="get">
      <input type="text" name="q" aria-labelledby="searchlabel" autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" placeholder="Search"/>
      <input type="submit" value="Go" />
    </form>
    </div>
</search>
<script>document.getElementById('searchbox').style.display = "block"</script><h3>Navigation</h3>

<div class="relations">
<h3>Related Topics</h3>
<ul>
  <li><a href="../../index.html">Documentation overview</a><ul>
  <li><a href="../index.html">Module code</a><ul>
  </ul></li>
  </ul></li>
</ul>
</div>








        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="footer">
      &#169;2024, Christopher Krolak.
      
      |
      Powered by <a href="https://www.sphinx-doc.org/">Sphinx 8.1.3</a>
      &amp; <a href="https://alabaster.readthedocs.io">Alabaster 1.0.0</a>
      
    </div>

    

    
  </body>
</html>
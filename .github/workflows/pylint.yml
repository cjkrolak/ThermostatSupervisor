name: Pylint
on: [push]
jobs:
  import-certificates:
    runs-on: ubuntu-latest
    outputs:
      certificates-imported: ${{ steps.check-https.outputs.has-https }}
    steps:
      - uses: actions/checkout@v4
      - name: Check for HTTPS servers in configuration
        id: check-https
        run: |
          # Check if there are any HTTPS servers configured
          if grep -r "https://" . --include="*.py" --include="*.json" \
             --include="*.yml" --include="*.yaml" || \
             grep -r ":443" . --include="*.py" --include="*.json" \
             --include="*.yml" --include="*.yaml" || \
             find . -name "*ssl*" -type f | grep -v ".git" | head -1; then
            echo "has-https=true" >> $GITHUB_OUTPUT
            echo "HTTPS servers or SSL configuration detected"
          else
            echo "has-https=false" >> $GITHUB_OUTPUT
            echo "No HTTPS servers detected"
          fi
      - name: Import SSL certificates for HTTPS servers
        if: steps.check-https.outputs.has-https == 'true'
        run: |
          echo "SSL/HTTPS configuration detected, certificates would be " \
               "imported in production"
          # In a real scenario, you would call the certificate import script
          # python download_ssl_certificates.py '[]' --verbose

  build:
    runs-on: ubuntu-latest
    needs: import-certificates
    strategy:
      matrix:
        python-version: ['3.9', '3.10', '3.11', '3.12', '3.13']
    steps:
      - uses: actions/checkout@v4
      - name: Set up Python ${{ matrix.python-version }}
        uses: actions/setup-python@v5
        with:
          python-version: ${{ matrix.python-version }}
      - name: Install dependencies
        run: |
          python -m pip install --upgrade pip
          pip install pylint
      - name: Analysing the code with pylint
        run: |-
          pylint $(git ls-files '*.py')

<!DOCTYPE html>

<html lang="en" data-content_root="../../">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>thermostatsupervisor.utilities &#8212; ThermostatSupervisor  documentation</title>
    <link rel="stylesheet" type="text/css" href="../../_static/pygments.css?v=d1102ebc" />
    <link rel="stylesheet" type="text/css" href="../../_static/basic.css?v=686e5160" />
    <link rel="stylesheet" type="text/css" href="../../_static/alabaster.css?v=27fed22d" />
    <script src="../../_static/documentation_options.js?v=5929fcd5"></script>
    <script src="../../_static/doctools.js?v=9bcbadda"></script>
    <script src="../../_static/sphinx_highlight.js?v=dc90522c"></script>
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" />
   
  <link rel="stylesheet" href="../../_static/custom.css" type="text/css" />
  

  
  

  </head><body>
  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          

          <div class="body" role="main">
            
  <h1>Source code for thermostatsupervisor.utilities</h1><div class="highlight"><pre>
<span></span><span class="sd">&quot;&quot;&quot;Common utility functions and globals.&quot;&quot;&quot;</span>

<span class="c1"># built-in libraries</span>
<span class="kn">import</span> <span class="nn">argparse</span>
<span class="kn">import</span> <span class="nn">configparser</span>
<span class="kn">import</span> <span class="nn">datetime</span>
<span class="kn">import</span> <span class="nn">inspect</span>
<span class="kn">import</span> <span class="nn">os</span>
<span class="kn">import</span> <span class="nn">socket</span>
<span class="kn">import</span> <span class="nn">sys</span>
<span class="kn">import</span> <span class="nn">traceback</span>


<span class="n">PACKAGE_NAME</span> <span class="o">=</span> <span class="s2">&quot;thermostatsupervisor&quot;</span>  <span class="c1"># should match name in __init__.py</span>

<span class="c1"># error codes</span>
<span class="n">NO_ERROR</span> <span class="o">=</span> <span class="mi">0</span>
<span class="n">CONNECTION_ERROR</span> <span class="o">=</span> <span class="mi">1</span>
<span class="n">AUTHORIZATION_ERROR</span> <span class="o">=</span> <span class="mi">2</span>
<span class="n">EMAIL_SEND_ERROR</span> <span class="o">=</span> <span class="mi">3</span>
<span class="n">ENVIRONMENT_ERROR</span> <span class="o">=</span> <span class="mi">4</span>
<span class="n">FILE_NOT_FOUND_ERROR</span> <span class="o">=</span> <span class="mi">5</span>
<span class="n">OTHER_ERROR</span> <span class="o">=</span> <span class="mi">99</span>

<span class="c1"># bogus values to identify uninitialized data</span>
<span class="n">BOGUS_INT</span> <span class="o">=</span> <span class="o">-</span><span class="mi">123456789</span>
<span class="n">BOGUS_BOOL</span> <span class="o">=</span> <span class="kc">False</span>
<span class="n">BOGUS_STR</span> <span class="o">=</span> <span class="s2">&quot;&lt;missing value&gt;&quot;</span>
<span class="n">bogus_dict</span> <span class="o">=</span> <span class="p">{}</span>

<span class="c1"># logging options</span>
<span class="n">STDOUT_LOG</span> <span class="o">=</span> <span class="mb">0b0001</span>  <span class="c1"># print to console</span>
<span class="n">DATA_LOG</span> <span class="o">=</span> <span class="mb">0b0010</span>  <span class="c1"># print to data log</span>
<span class="n">BOTH_LOG</span> <span class="o">=</span> <span class="mb">0b0011</span>  <span class="c1"># log to both console and data logs</span>
<span class="n">DEBUG_LOG</span> <span class="o">=</span> <span class="mb">0b0100</span>  <span class="c1"># print only if debug mode is on</span>
<span class="n">STDERR_LOG</span> <span class="o">=</span> <span class="mb">0b1000</span>  <span class="c1"># print to stderr</span>

<span class="c1"># unique log modes (excluding combinations)</span>
<span class="n">log_modes</span> <span class="o">=</span> <span class="p">{</span>
    <span class="n">STDOUT_LOG</span><span class="p">:</span> <span class="s2">&quot;stdout log&quot;</span><span class="p">,</span>
    <span class="n">DATA_LOG</span><span class="p">:</span> <span class="s2">&quot;data log&quot;</span><span class="p">,</span>
    <span class="n">DEBUG_LOG</span><span class="p">:</span> <span class="s2">&quot;print only if debug mode enabled&quot;</span><span class="p">,</span>
    <span class="n">STDERR_LOG</span><span class="p">:</span> <span class="s2">&quot;stderr log&quot;</span><span class="p">,</span>
<span class="p">}</span>

<span class="n">FILE_PATH</span> <span class="o">=</span> <span class="s2">&quot;.//data&quot;</span>
<span class="n">MAX_LOG_SIZE_BYTES</span> <span class="o">=</span> <span class="mi">2</span><span class="o">**</span><span class="mi">20</span>  <span class="c1"># logs rotate at this max size</span>
<span class="n">HTTP_TIMEOUT</span> <span class="o">=</span> <span class="mi">60</span>  <span class="c1"># timeout in seconds</span>
<span class="n">MIN_WIFI_DBM</span> <span class="o">=</span> <span class="o">-</span><span class="mf">70.0</span>  <span class="c1"># min viable WIFI signal strength</span>

<span class="c1"># set unit test IP address, same as client</span>
<span class="n">unit_test_mode</span> <span class="o">=</span> <span class="kc">False</span>  <span class="c1"># in unit test mode</span>
<span class="n">log_stdout_to_stderr</span> <span class="o">=</span> <span class="kc">False</span>  <span class="c1"># in flask server mode</span>


<div class="viewcode-block" id="get_function_name">
<a class="viewcode-back" href="../../docs/thermostatsupervisor.html#thermostatsupervisor.utilities.get_function_name">[docs]</a>
<span class="k">def</span> <span class="nf">get_function_name</span><span class="p">(</span><span class="n">stack_value</span><span class="o">=</span><span class="mi">1</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Return function name from stack.</span>

<span class="sd">    inputs:</span>
<span class="sd">        stack_val(int): position in stack, 1=caller, 2=caller&#39;s parent</span>
<span class="sd">    returns:</span>
<span class="sd">        (str): function name</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="n">inspect</span><span class="o">.</span><span class="n">stack</span><span class="p">()[</span><span class="n">stack_value</span><span class="p">][</span><span class="mi">3</span><span class="p">]</span></div>



<div class="viewcode-block" id="log_msg">
<a class="viewcode-back" href="../../docs/thermostatsupervisor.html#thermostatsupervisor.utilities.log_msg">[docs]</a>
<span class="k">def</span> <span class="nf">log_msg</span><span class="p">(</span><span class="n">msg</span><span class="p">,</span> <span class="n">mode</span><span class="p">,</span> <span class="n">func_name</span><span class="o">=-</span><span class="mi">1</span><span class="p">,</span> <span class="n">file_name</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Log message to file, console, etc.</span>

<span class="sd">    inputs:</span>
<span class="sd">        msg(str): message to log</span>
<span class="sd">        mode(int): log destination(s), see logging options at top of file</span>
<span class="sd">        func_name(int): if &gt; 1, will include func name from this stack position</span>
<span class="sd">        file_name(str): if None will use default name</span>
<span class="sd">    returns:</span>
<span class="sd">        (dict): {status, tbd}</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">return_buffer</span> <span class="o">=</span> <span class="p">{</span>
        <span class="s2">&quot;status&quot;</span><span class="p">:</span> <span class="n">NO_ERROR</span><span class="p">,</span>
    <span class="p">}</span>

    <span class="c1"># set debug mode</span>
    <span class="n">debug_enabled</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">log_msg</span><span class="p">,</span> <span class="s2">&quot;debug&quot;</span><span class="p">,</span> <span class="kc">False</span><span class="p">)</span>
    <span class="n">debug_msg</span> <span class="o">=</span> <span class="n">mode</span> <span class="o">&amp;</span> <span class="n">DEBUG_LOG</span>
    <span class="n">filter_debug_msg</span> <span class="o">=</span> <span class="n">debug_msg</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">debug_enabled</span>

    <span class="c1"># cast STDOUT_LOG to STDERR_LOG in flask server mode</span>
    <span class="k">if</span> <span class="n">log_stdout_to_stderr</span> <span class="ow">and</span> <span class="p">(</span><span class="n">mode</span> <span class="o">&amp;</span> <span class="n">STDOUT_LOG</span><span class="p">)</span> <span class="ow">and</span> <span class="ow">not</span> <span class="p">(</span><span class="n">mode</span> <span class="o">&amp;</span> <span class="n">STDERR_LOG</span><span class="p">):</span>
        <span class="n">mode</span> <span class="o">=</span> <span class="n">mode</span> <span class="o">+</span> <span class="n">STDERR_LOG</span> <span class="o">-</span> <span class="n">STDOUT_LOG</span>

    <span class="c1"># define filename</span>
    <span class="k">if</span> <span class="n">file_name</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">log_msg</span><span class="o">.</span><span class="n">file_name</span> <span class="o">=</span> <span class="n">file_name</span>

    <span class="c1"># build message string</span>
    <span class="k">if</span> <span class="n">func_name</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
        <span class="n">msg</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;[</span><span class="si">{</span><span class="n">get_function_name</span><span class="p">(</span><span class="n">func_name</span><span class="p">)</span><span class="si">}</span><span class="s2">]: </span><span class="si">{</span><span class="n">msg</span><span class="si">}</span><span class="s2">&quot;</span>

    <span class="c1"># log to data file</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">mode</span> <span class="o">&amp;</span> <span class="n">DATA_LOG</span><span class="p">)</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">filter_debug_msg</span><span class="p">:</span>
        <span class="c1"># create directory if needed</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">FILE_PATH</span><span class="p">):</span>
            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;data folder &#39;</span><span class="si">{</span><span class="n">FILE_PATH</span><span class="si">}</span><span class="s2">&#39; created.&quot;</span><span class="p">)</span>
            <span class="n">os</span><span class="o">.</span><span class="n">makedirs</span><span class="p">(</span><span class="n">FILE_PATH</span><span class="p">)</span>

        <span class="c1"># build full file name</span>
        <span class="n">full_path</span> <span class="o">=</span> <span class="n">get_full_file_path</span><span class="p">(</span><span class="n">log_msg</span><span class="o">.</span><span class="n">file_name</span><span class="p">)</span>

        <span class="c1"># check file size and rotate if necessary</span>
        <span class="n">file_size_bytes</span> <span class="o">=</span> <span class="n">get_file_size_bytes</span><span class="p">(</span><span class="n">full_path</span><span class="p">)</span>
        <span class="n">file_size_bytes</span> <span class="o">=</span> <span class="n">log_rotate_file</span><span class="p">(</span>
            <span class="n">full_path</span><span class="p">,</span> <span class="n">file_size_bytes</span><span class="p">,</span> <span class="n">MAX_LOG_SIZE_BYTES</span>
        <span class="p">)</span>

        <span class="c1"># write to file</span>
        <span class="n">write_to_file</span><span class="p">(</span><span class="n">full_path</span><span class="p">,</span> <span class="n">file_size_bytes</span><span class="p">,</span> <span class="n">msg</span><span class="p">)</span>

    <span class="c1"># print to console</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">mode</span> <span class="o">&amp;</span> <span class="n">STDOUT_LOG</span><span class="p">)</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">filter_debug_msg</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span>

    <span class="c1"># print to error stream</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">mode</span> <span class="o">&amp;</span> <span class="n">STDERR_LOG</span><span class="p">)</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">filter_debug_msg</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="n">msg</span><span class="p">,</span> <span class="n">file</span><span class="o">=</span><span class="n">sys</span><span class="o">.</span><span class="n">stderr</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">return_buffer</span></div>



<span class="c1"># global default log file name if none is specified</span>
<span class="n">log_msg</span><span class="o">.</span><span class="n">file_name</span> <span class="o">=</span> <span class="s2">&quot;default_log.txt&quot;</span>


<div class="viewcode-block" id="get_file_size_bytes">
<a class="viewcode-back" href="../../docs/thermostatsupervisor.html#thermostatsupervisor.utilities.get_file_size_bytes">[docs]</a>
<span class="k">def</span> <span class="nf">get_file_size_bytes</span><span class="p">(</span><span class="n">full_path</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Get the file size for the specified log file.</span>

<span class="sd">    inputs:</span>
<span class="sd">        full_path(str): full file name and path.</span>
<span class="sd">    returns:</span>
<span class="sd">        file_size_bytes(int): file size in bytes</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="n">file_size_bytes</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">getsize</span><span class="p">(</span><span class="n">full_path</span><span class="p">)</span>
    <span class="k">except</span> <span class="ne">FileNotFoundError</span><span class="p">:</span>
        <span class="c1"># file does not exist</span>
        <span class="n">file_size_bytes</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="k">return</span> <span class="n">file_size_bytes</span></div>



<div class="viewcode-block" id="log_rotate_file">
<a class="viewcode-back" href="../../docs/thermostatsupervisor.html#thermostatsupervisor.utilities.log_rotate_file">[docs]</a>
<span class="k">def</span> <span class="nf">log_rotate_file</span><span class="p">(</span><span class="n">full_path</span><span class="p">,</span> <span class="n">file_size_bytes</span><span class="p">,</span> <span class="n">max_size_bytes</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Rotate log file to prevent file from getting too large.</span>

<span class="sd">    inputs:</span>
<span class="sd">        full_path(str): full file name and path.</span>
<span class="sd">        file_size_bytes(int): file size in bytes</span>
<span class="sd">        max_size_bytes(int): max allowable file size.</span>
<span class="sd">    returns:</span>
<span class="sd">        file_size_bytes(int): file size in bytes</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="n">file_size_bytes</span> <span class="o">&gt;</span> <span class="n">max_size_bytes</span><span class="p">:</span>
        <span class="c1"># rotate log file</span>
        <span class="n">current_date</span> <span class="o">=</span> <span class="n">datetime</span><span class="o">.</span><span class="n">datetime</span><span class="o">.</span><span class="n">today</span><span class="p">()</span><span class="o">.</span><span class="n">strftime</span><span class="p">(</span><span class="s2">&quot;</span><span class="si">%d</span><span class="s2">-%b-%Y-%H-%M-%S&quot;</span><span class="p">)</span>
        <span class="n">os</span><span class="o">.</span><span class="n">rename</span><span class="p">(</span><span class="n">full_path</span><span class="p">,</span> <span class="n">full_path</span><span class="p">[:</span><span class="o">-</span><span class="mi">4</span><span class="p">]</span> <span class="o">+</span> <span class="s2">&quot;-&quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">current_date</span><span class="p">)</span> <span class="o">+</span> <span class="s2">&quot;.txt&quot;</span><span class="p">)</span>
        <span class="n">file_size_bytes</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="k">return</span> <span class="n">file_size_bytes</span></div>



<div class="viewcode-block" id="write_to_file">
<a class="viewcode-back" href="../../docs/thermostatsupervisor.html#thermostatsupervisor.utilities.write_to_file">[docs]</a>
<span class="k">def</span> <span class="nf">write_to_file</span><span class="p">(</span><span class="n">full_path</span><span class="p">,</span> <span class="n">file_size_bytes</span><span class="p">,</span> <span class="n">msg</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Rotate log file to prevent file from getting too large.</span>

<span class="sd">    inputs:</span>
<span class="sd">        full_path(str): full file name and path.</span>
<span class="sd">        file_size_bytes(int): file size in bytes</span>
<span class="sd">        msg(str): message to write.</span>
<span class="sd">    returns:</span>
<span class="sd">        (int): number of bytes written to file.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="n">file_size_bytes</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
        <span class="n">write_mode</span> <span class="o">=</span> <span class="s2">&quot;w&quot;</span>  <span class="c1"># writing</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">write_mode</span> <span class="o">=</span> <span class="s2">&quot;a&quot;</span>  <span class="c1"># appending</span>
    <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">full_path</span><span class="p">,</span> <span class="n">write_mode</span><span class="p">,</span> <span class="n">encoding</span><span class="o">=</span><span class="s2">&quot;utf8&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">file_handle</span><span class="p">:</span>
        <span class="n">msg_to_write</span> <span class="o">=</span> <span class="n">msg</span> <span class="o">+</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span>
        <span class="n">file_handle</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">msg_to_write</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">utf8len</span><span class="p">(</span><span class="n">msg_to_write</span><span class="p">)</span></div>



<div class="viewcode-block" id="get_full_file_path">
<a class="viewcode-back" href="../../docs/thermostatsupervisor.html#thermostatsupervisor.utilities.get_full_file_path">[docs]</a>
<span class="k">def</span> <span class="nf">get_full_file_path</span><span class="p">(</span><span class="n">file_name</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Return full file path.</span>

<span class="sd">    inputs:</span>
<span class="sd">        file_name(str): name of file with extension</span>
<span class="sd">    returns:</span>
<span class="sd">        (str) full file name and path</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="n">FILE_PATH</span> <span class="o">+</span> <span class="s2">&quot;//&quot;</span> <span class="o">+</span> <span class="n">file_name</span></div>



<div class="viewcode-block" id="utf8len">
<a class="viewcode-back" href="../../docs/thermostatsupervisor.html#thermostatsupervisor.utilities.utf8len">[docs]</a>
<span class="k">def</span> <span class="nf">utf8len</span><span class="p">(</span><span class="n">input_string</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Return length of string in bytes.</span>

<span class="sd">    inputs:</span>
<span class="sd">        input_string(str): input string.</span>
<span class="sd">    returns:</span>
<span class="sd">        (int): length of string in bytes.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="nb">len</span><span class="p">(</span><span class="n">input_string</span><span class="o">.</span><span class="n">encode</span><span class="p">(</span><span class="s2">&quot;utf-8&quot;</span><span class="p">))</span></div>



<div class="viewcode-block" id="temp_value_with_units">
<a class="viewcode-back" href="../../docs/thermostatsupervisor.html#thermostatsupervisor.utilities.temp_value_with_units">[docs]</a>
<span class="k">def</span> <span class="nf">temp_value_with_units</span><span class="p">(</span><span class="n">raw</span><span class="p">,</span> <span class="n">disp_unit</span><span class="o">=</span><span class="s2">&quot;F&quot;</span><span class="p">,</span> <span class="n">precision</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Return string representing temperature and units.</span>

<span class="sd">    inputs:</span>
<span class="sd">        raw(int or float): temperature value.</span>
<span class="sd">        disp_unit(str): display unit character.</span>
<span class="sd">        precision(int): number of digits after decimal.</span>
<span class="sd">    returns:</span>
<span class="sd">        (str): temperature and units.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="n">disp_unit</span><span class="o">.</span><span class="n">upper</span><span class="p">()</span> <span class="ow">not</span> <span class="ow">in</span> <span class="p">[</span><span class="s2">&quot;C&quot;</span><span class="p">,</span> <span class="s2">&quot;F&quot;</span><span class="p">,</span> <span class="s2">&quot;K&quot;</span><span class="p">]:</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
            <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">get_function_name</span><span class="p">()</span><span class="si">}</span><span class="s2">: &#39;</span><span class="si">{</span><span class="n">disp_unit</span><span class="si">}</span><span class="s2">&#39; is not a valid temperature unit&quot;</span>
        <span class="p">)</span>

    <span class="c1"># if string try to convert to float</span>
    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">raw</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
        <span class="k">if</span> <span class="s2">&quot;°&quot;</span> <span class="ow">in</span> <span class="n">raw</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">raw</span>  <span class="c1"># pass-thru</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">raw</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">raw</span><span class="p">)</span>
        <span class="k">except</span> <span class="ne">ValueError</span><span class="p">:</span>
            <span class="k">pass</span>

    <span class="k">if</span> <span class="n">raw</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">formatted</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">raw</span><span class="si">}</span><span class="s2">&quot;</span>
    <span class="k">elif</span> <span class="n">precision</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
        <span class="n">formatted</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">raw</span><span class="si">:</span><span class="s2">.0f</span><span class="si">}</span><span class="s2">&quot;</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">formatted</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">raw</span><span class="si">:</span><span class="s2">.</span><span class="si">{</span><span class="n">precision</span><span class="si">}</span><span class="s2">f</span><span class="si">}</span><span class="s2">&quot;</span>
    <span class="k">return</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">formatted</span><span class="si">}</span><span class="s2">°</span><span class="si">{</span><span class="n">disp_unit</span><span class="si">}</span><span class="s2">&quot;</span></div>



<div class="viewcode-block" id="humidity_value_with_units">
<a class="viewcode-back" href="../../docs/thermostatsupervisor.html#thermostatsupervisor.utilities.humidity_value_with_units">[docs]</a>
<span class="k">def</span> <span class="nf">humidity_value_with_units</span><span class="p">(</span><span class="n">raw</span><span class="p">,</span> <span class="n">disp_unit</span><span class="o">=</span><span class="s2">&quot; RH&quot;</span><span class="p">,</span> <span class="n">precision</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Return string representing humidity and units.</span>

<span class="sd">    inputs:</span>
<span class="sd">        raw(int or float): humidity value.</span>
<span class="sd">        disp_unit(str): display unit character.</span>
<span class="sd">        precision(int): number of digits after decimal.</span>
<span class="sd">    returns:</span>
<span class="sd">        (str): temperature and units.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="n">disp_unit</span><span class="o">.</span><span class="n">upper</span><span class="p">()</span> <span class="ow">not</span> <span class="ow">in</span> <span class="p">[</span><span class="s2">&quot;RH&quot;</span><span class="p">,</span> <span class="s2">&quot; RH&quot;</span><span class="p">]:</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
            <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">get_function_name</span><span class="p">()</span><span class="si">}</span><span class="s2">: &#39;</span><span class="si">{</span><span class="n">disp_unit</span><span class="si">}</span><span class="s2">&#39; is not a valid humidity unit&quot;</span>
        <span class="p">)</span>

    <span class="c1"># if string try to convert to float</span>
    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">raw</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
        <span class="k">if</span> <span class="s2">&quot;%&quot;</span> <span class="ow">in</span> <span class="n">raw</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">raw</span>  <span class="c1"># pass-thru</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">raw</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">raw</span><span class="p">)</span>
        <span class="k">except</span> <span class="ne">ValueError</span><span class="p">:</span>
            <span class="k">pass</span>

    <span class="k">if</span> <span class="n">raw</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">formatted</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">raw</span><span class="si">}</span><span class="s2">&quot;</span>
    <span class="k">elif</span> <span class="n">precision</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
        <span class="n">formatted</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">raw</span><span class="si">:</span><span class="s2">.0f</span><span class="si">}</span><span class="s2">&quot;</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">formatted</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">raw</span><span class="si">:</span><span class="s2">.</span><span class="si">{</span><span class="n">precision</span><span class="si">}</span><span class="s2">f</span><span class="si">}</span><span class="s2">&quot;</span>
    <span class="k">return</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">formatted</span><span class="si">}</span><span class="s2">%</span><span class="si">{</span><span class="n">disp_unit</span><span class="si">}</span><span class="s2">&quot;</span></div>



<div class="viewcode-block" id="get_key_from_value">
<a class="viewcode-back" href="../../docs/thermostatsupervisor.html#thermostatsupervisor.utilities.get_key_from_value">[docs]</a>
<span class="k">def</span> <span class="nf">get_key_from_value</span><span class="p">(</span><span class="n">input_dict</span><span class="p">,</span> <span class="n">val</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Return first key found in dict from value provided.</span>

<span class="sd">    Matching criteria depends upon the type of the value contained</span>
<span class="sd">    within the input dictionary:</span>
<span class="sd">        (str, int, float): exact value match required</span>
<span class="sd">        (dict): exact match of one of the child keys or values required</span>
<span class="sd">        (list): exact match of one of the list elements provided</span>
<span class="sd">        (other type): TypeError raised</span>

<span class="sd">    inputs:</span>
<span class="sd">        input_dict(dict): target dictionary</span>
<span class="sd">        val(str, int, float, dict, list):  value</span>
<span class="sd">    returns:</span>
<span class="sd">        (str or int): dictionary key</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">for</span> <span class="n">key</span><span class="p">,</span> <span class="n">value</span> <span class="ow">in</span> <span class="n">input_dict</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="p">(</span><span class="nb">str</span><span class="p">,</span> <span class="nb">int</span><span class="p">,</span> <span class="nb">float</span><span class="p">)):</span>
            <span class="c1"># match value</span>
            <span class="k">if</span> <span class="n">val</span> <span class="o">==</span> <span class="n">value</span><span class="p">:</span>
                <span class="k">return</span> <span class="n">key</span>
        <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="nb">dict</span><span class="p">):</span>
            <span class="c1"># match key of child dict</span>
            <span class="k">if</span> <span class="n">val</span> <span class="ow">in</span> <span class="n">value</span><span class="o">.</span><span class="n">keys</span><span class="p">()</span> <span class="ow">or</span> <span class="n">val</span> <span class="ow">in</span> <span class="n">value</span><span class="o">.</span><span class="n">values</span><span class="p">():</span>
                <span class="k">return</span> <span class="n">key</span>
        <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="nb">list</span><span class="p">):</span>
            <span class="c1"># match key to any value in child list</span>
            <span class="k">if</span> <span class="n">val</span> <span class="ow">in</span> <span class="n">value</span><span class="p">:</span>
                <span class="k">return</span> <span class="n">key</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span>
                <span class="sa">f</span><span class="s2">&quot;type </span><span class="si">{</span><span class="nb">type</span><span class="p">(</span><span class="n">value</span><span class="p">)</span><span class="si">}</span><span class="s2"> not yet supported in get_key_from_value&quot;</span>
            <span class="p">)</span>

    <span class="c1"># key not found</span>
    <span class="k">raise</span> <span class="ne">KeyError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;key not found in dict &#39;</span><span class="si">{</span><span class="n">input_dict</span><span class="si">}</span><span class="s2">&#39; with value=&#39;</span><span class="si">{</span><span class="n">val</span><span class="si">}</span><span class="s2">&#39;&quot;</span><span class="p">)</span></div>



<div class="viewcode-block" id="c_to_f">
<a class="viewcode-back" href="../../docs/thermostatsupervisor.html#thermostatsupervisor.utilities.c_to_f">[docs]</a>
<span class="k">def</span> <span class="nf">c_to_f</span><span class="p">(</span><span class="n">tempc</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">float</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Convert from Celsius to Fahrenheit.</span>

<span class="sd">    inputs:</span>
<span class="sd">        tempc(int, float): temp in °C.</span>
<span class="sd">    returns:</span>
<span class="sd">        (float): temp in °F.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">tempc</span><span class="p">,</span> <span class="nb">type</span><span class="p">(</span><span class="kc">None</span><span class="p">)):</span>
        <span class="k">return</span> <span class="n">tempc</span>  <span class="c1"># pass thru</span>
    <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">tempc</span><span class="p">,</span> <span class="p">(</span><span class="nb">int</span><span class="p">,</span> <span class="nb">float</span><span class="p">)):</span>
        <span class="k">return</span> <span class="n">tempc</span> <span class="o">*</span> <span class="mf">9.0</span> <span class="o">/</span> <span class="mi">5</span> <span class="o">+</span> <span class="mi">32</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;raw value &#39;</span><span class="si">{</span><span class="n">tempc</span><span class="si">}</span><span class="s2">&#39; is not an int or float&quot;</span><span class="p">)</span></div>



<div class="viewcode-block" id="f_to_c">
<a class="viewcode-back" href="../../docs/thermostatsupervisor.html#thermostatsupervisor.utilities.f_to_c">[docs]</a>
<span class="k">def</span> <span class="nf">f_to_c</span><span class="p">(</span><span class="n">tempf</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">float</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Convert from Fahrenheit to Celsius.</span>

<span class="sd">    inputs:</span>
<span class="sd">        tempc(int, float): temp in °F.</span>
<span class="sd">    returns:</span>
<span class="sd">        (float): temp in °C.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">tempf</span><span class="p">,</span> <span class="nb">type</span><span class="p">(</span><span class="kc">None</span><span class="p">)):</span>
        <span class="k">return</span> <span class="n">tempf</span>  <span class="c1"># pass thru</span>
    <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">tempf</span><span class="p">,</span> <span class="p">(</span><span class="nb">int</span><span class="p">,</span> <span class="nb">float</span><span class="p">)):</span>
        <span class="k">return</span> <span class="p">(</span><span class="n">tempf</span> <span class="o">-</span> <span class="mi">32</span><span class="p">)</span> <span class="o">*</span> <span class="mi">5</span> <span class="o">/</span> <span class="mf">9.0</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;raw value &#39;</span><span class="si">{</span><span class="n">tempf</span><span class="si">}</span><span class="s2">&#39; is not an int or float&quot;</span><span class="p">)</span></div>



<div class="viewcode-block" id="is_host_on_local_net">
<a class="viewcode-back" href="../../docs/thermostatsupervisor.html#thermostatsupervisor.utilities.is_host_on_local_net">[docs]</a>
<span class="k">def</span> <span class="nf">is_host_on_local_net</span><span class="p">(</span><span class="n">host_name</span><span class="p">,</span> <span class="n">ip_address</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">verbose</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Return True if specified host is on local network.</span>
<span class="sd">    socket.gethostbyaddr() throws exception for some IP address</span>
<span class="sd">    so preferred way to use this function is to pass in only the</span>
<span class="sd">    hostname and leave the IP as default (None).</span>
<span class="sd">    inputs:</span>
<span class="sd">        host_name(str): expected host name.</span>
<span class="sd">        ip_address(str): target IP address on local net.</span>
<span class="sd">        verbose(bool): if True, print out status.</span>
<span class="sd">    returns:</span>
<span class="sd">        tuple(bool, str): True if confirmed on local net, else False.</span>
<span class="sd">                          ip_address if known</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">host_found</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="c1"># find by hostname alone if IP is None</span>
    <span class="k">if</span> <span class="n">ip_address</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">host_found</span> <span class="o">=</span> <span class="n">socket</span><span class="o">.</span><span class="n">gethostbyname</span><span class="p">(</span><span class="n">host_name</span><span class="p">)</span>
        <span class="k">except</span> <span class="n">socket</span><span class="o">.</span><span class="n">gaierror</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">verbose</span> <span class="ow">and</span> <span class="kc">False</span><span class="p">:</span>
                <span class="c1"># for debug, currently disabled.</span>
                <span class="nb">print</span><span class="p">(</span><span class="n">traceback</span><span class="o">.</span><span class="n">format_exc</span><span class="p">())</span>
            <span class="k">return</span> <span class="kc">False</span><span class="p">,</span> <span class="kc">None</span>
        <span class="k">if</span> <span class="n">host_found</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">verbose</span><span class="p">:</span>
                <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;host </span><span class="si">{</span><span class="n">host_name</span><span class="si">}</span><span class="s2"> found at </span><span class="si">{</span><span class="n">host_found</span><span class="si">}</span><span class="s2"> on local net&quot;</span><span class="p">)</span>
            <span class="k">return</span> <span class="kc">True</span><span class="p">,</span> <span class="n">host_found</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">verbose</span><span class="p">:</span>
                <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;host </span><span class="si">{</span><span class="n">host_name</span><span class="si">}</span><span class="s2"> is not detected on local net&quot;</span><span class="p">)</span>
            <span class="k">return</span> <span class="kc">False</span><span class="p">,</span> <span class="kc">None</span>

    <span class="k">else</span><span class="p">:</span>
        <span class="c1"># match both IP and host if both are provided.</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">host_found</span> <span class="o">=</span> <span class="n">socket</span><span class="o">.</span><span class="n">gethostbyaddr</span><span class="p">(</span><span class="n">ip_address</span><span class="p">)</span>
        <span class="k">except</span> <span class="n">socket</span><span class="o">.</span><span class="n">herror</span><span class="p">:</span>  <span class="c1"># exception if DNS name is not set</span>
            <span class="k">if</span> <span class="n">verbose</span> <span class="ow">and</span> <span class="kc">False</span><span class="p">:</span>
                <span class="c1"># for debug, currently disabled.</span>
                <span class="nb">print</span><span class="p">(</span><span class="n">traceback</span><span class="o">.</span><span class="n">format_exc</span><span class="p">())</span>
            <span class="k">return</span> <span class="kc">False</span><span class="p">,</span> <span class="kc">None</span>
        <span class="k">if</span> <span class="n">host_name</span> <span class="o">==</span> <span class="n">host_found</span><span class="p">[</span><span class="mi">0</span><span class="p">]:</span>
            <span class="k">return</span> <span class="kc">True</span><span class="p">,</span> <span class="n">ip_address</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;DEBUG: expected host=</span><span class="si">{</span><span class="n">host_name</span><span class="si">}</span><span class="s2">, &quot;</span> <span class="sa">f</span><span class="s2">&quot;actual host=</span><span class="si">{</span><span class="n">host_found</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
            <span class="k">return</span> <span class="kc">False</span><span class="p">,</span> <span class="kc">None</span></div>



<span class="c1"># default parent_key if user_inputs are not pulled from file</span>
<span class="n">default_parent_key</span> <span class="o">=</span> <span class="s2">&quot;argv&quot;</span>


<div class="viewcode-block" id="UserInputs">
<a class="viewcode-back" href="../../docs/thermostatsupervisor.html#thermostatsupervisor.utilities.UserInputs">[docs]</a>
<span class="k">class</span> <span class="nc">UserInputs</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Manage runtime arguments.&quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">argv_list</span><span class="p">,</span>
        <span class="n">help_description</span><span class="p">,</span>
        <span class="n">suppress_warnings</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
        <span class="n">parent_key</span><span class="o">=</span><span class="n">default_parent_key</span><span class="p">,</span>
        <span class="o">*</span><span class="n">_</span><span class="p">,</span>
        <span class="o">**</span><span class="n">__</span><span class="p">,</span>
    <span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Base Class UserInputs Constructor.</span>

<span class="sd">        user_inputs is a dictionary of runtime parameters.</span>
<span class="sd">        structure = {&lt;parent_key&gt; : {&lt;child_key: {}}</span>
<span class="sd">        dict can have multiple parent_keys and multiple child_keys</span>

<span class="sd">        inputs:</span>
<span class="sd">            argv_list(list): override runtime values.</span>
<span class="sd">            help_description(str): description field for help text.</span>
<span class="sd">            suppress_warnings(bool): True to suppress warning msgs.</span>
<span class="sd">            parent_key(str, int): parent key</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">argv_list</span> <span class="o">=</span> <span class="n">argv_list</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">default_parent_key</span> <span class="o">=</span> <span class="n">parent_key</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">parent_keys</span> <span class="o">=</span> <span class="p">[</span><span class="n">parent_key</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">help_description</span> <span class="o">=</span> <span class="n">help_description</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">suppress_warnings</span> <span class="o">=</span> <span class="n">suppress_warnings</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">parser</span> <span class="o">=</span> <span class="n">argparse</span><span class="o">.</span><span class="n">ArgumentParser</span><span class="p">(</span><span class="n">description</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">help_description</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">user_inputs</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">user_inputs_file</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">using_input_file</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">initialize_user_inputs</span><span class="p">()</span>
        <span class="c1"># parse the runtime arguments from input list or sys.argv</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">parse_runtime_parameters</span><span class="p">(</span><span class="n">argv_list</span><span class="p">)</span>

<div class="viewcode-block" id="UserInputs.initialize_user_inputs">
<a class="viewcode-back" href="../../docs/thermostatsupervisor.html#thermostatsupervisor.utilities.UserInputs.initialize_user_inputs">[docs]</a>
    <span class="k">def</span> <span class="nf">initialize_user_inputs</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">parent_keys</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Populate user_inputs dictionary.&quot;&quot;&quot;</span>
        <span class="k">pass</span>  <span class="c1"># placeholder, is instance-specific</span></div>


<div class="viewcode-block" id="UserInputs.get_sflag_list">
<a class="viewcode-back" href="../../docs/thermostatsupervisor.html#thermostatsupervisor.utilities.UserInputs.get_sflag_list">[docs]</a>
    <span class="k">def</span> <span class="nf">get_sflag_list</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Return a list of all sflags.&quot;&quot;&quot;</span>
        <span class="n">valid_sflags</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">parent_key</span><span class="p">,</span> <span class="n">child_dict</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">user_inputs</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="k">for</span> <span class="n">child_key</span><span class="p">,</span> <span class="n">_</span> <span class="ow">in</span> <span class="n">child_dict</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
                <span class="n">valid_sflags</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">user_inputs</span><span class="p">[</span><span class="n">parent_key</span><span class="p">][</span><span class="n">child_key</span><span class="p">][</span><span class="s2">&quot;sflag&quot;</span><span class="p">])</span>
        <span class="k">return</span> <span class="n">valid_sflags</span></div>


<div class="viewcode-block" id="UserInputs.parse_runtime_parameters">
<a class="viewcode-back" href="../../docs/thermostatsupervisor.html#thermostatsupervisor.utilities.UserInputs.parse_runtime_parameters">[docs]</a>
    <span class="k">def</span> <span class="nf">parse_runtime_parameters</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">argv_list</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Parse all runtime parameters from list, argv list or named</span>
<span class="sd">        arguments.</span>

<span class="sd">        If argv_list is input then algo will default to input list.</span>
<span class="sd">        ElIf hyphen is found in argv the algo will default to named args.</span>
<span class="sd">        inputs:</span>
<span class="sd">           argv_list: list override for sys.argv</span>
<span class="sd">        returns:</span>
<span class="sd">          argv_dict(dict)</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">sysargv_sflags</span> <span class="o">=</span> <span class="p">[</span><span class="nb">str</span><span class="p">(</span><span class="n">elem</span><span class="p">)[:</span><span class="mi">2</span><span class="p">]</span> <span class="k">for</span> <span class="n">elem</span> <span class="ow">in</span> <span class="n">sys</span><span class="o">.</span><span class="n">argv</span><span class="p">[</span><span class="mi">1</span><span class="p">:]]</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">user_inputs</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;user_inputs cannot be None&quot;</span><span class="p">)</span>
        <span class="n">parent_key</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">user_inputs</span><span class="o">.</span><span class="n">keys</span><span class="p">())[</span><span class="mi">0</span><span class="p">]</span>
        <span class="n">valid_sflags</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_sflag_list</span><span class="p">()</span>
        <span class="n">valid_sflags</span> <span class="o">+=</span> <span class="p">[</span><span class="s2">&quot;-h&quot;</span><span class="p">,</span> <span class="s2">&quot;--&quot;</span><span class="p">]</span>  <span class="c1"># add help and double dash</span>
        <span class="k">if</span> <span class="n">argv_list</span><span class="p">:</span>
            <span class="c1"># argument list input, support parsing list</span>
            <span class="n">argvlist_sflags</span> <span class="o">=</span> <span class="p">[</span><span class="nb">str</span><span class="p">(</span><span class="n">elem</span><span class="p">)[:</span><span class="mi">2</span><span class="p">]</span> <span class="k">for</span> <span class="n">elem</span> <span class="ow">in</span> <span class="n">argv_list</span><span class="p">]</span>
            <span class="k">if</span> <span class="nb">any</span><span class="p">([</span><span class="n">flag</span> <span class="ow">in</span> <span class="n">argvlist_sflags</span> <span class="k">for</span> <span class="n">flag</span> <span class="ow">in</span> <span class="n">valid_sflags</span><span class="p">]):</span>
                <span class="n">log_msg</span><span class="p">(</span>
                    <span class="sa">f</span><span class="s2">&quot;parsing named runtime parameters from user input list: &quot;</span>
                    <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">argv_list</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span>
                    <span class="n">mode</span><span class="o">=</span><span class="n">DEBUG_LOG</span> <span class="o">+</span> <span class="n">STDOUT_LOG</span><span class="p">,</span>
                    <span class="n">func_name</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
                <span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">parse_named_arguments</span><span class="p">(</span><span class="n">argv_list</span><span class="o">=</span><span class="n">argv_list</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">log_msg</span><span class="p">(</span>
                    <span class="sa">f</span><span class="s2">&quot;parsing runtime parameters from user input list: &quot;</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">argv_list</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span>
                    <span class="n">mode</span><span class="o">=</span><span class="n">DEBUG_LOG</span> <span class="o">+</span> <span class="n">STDOUT_LOG</span><span class="p">,</span>
                    <span class="n">func_name</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
                <span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">parse_argv_list</span><span class="p">(</span><span class="n">parent_key</span><span class="p">,</span> <span class="n">argv_list</span><span class="p">)</span>
        <span class="k">elif</span> <span class="nb">any</span><span class="p">([</span><span class="n">flag</span> <span class="ow">in</span> <span class="n">sysargv_sflags</span> <span class="k">for</span> <span class="n">flag</span> <span class="ow">in</span> <span class="n">valid_sflags</span><span class="p">]):</span>
            <span class="c1"># named arguments from sys.argv</span>
            <span class="n">log_msg</span><span class="p">(</span>
                <span class="sa">f</span><span class="s2">&quot;parsing named runtime parameters from sys.argv: </span><span class="si">{</span><span class="n">sys</span><span class="o">.</span><span class="n">argv</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span>
                <span class="n">mode</span><span class="o">=</span><span class="n">DEBUG_LOG</span> <span class="o">+</span> <span class="n">STDOUT_LOG</span><span class="p">,</span>
                <span class="n">func_name</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
            <span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">parse_named_arguments</span><span class="p">()</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="c1"># sys.argv parsing</span>
            <span class="n">log_msg</span><span class="p">(</span>
                <span class="sa">f</span><span class="s2">&quot;parsing runtime parameters from sys.argv: </span><span class="si">{</span><span class="n">sys</span><span class="o">.</span><span class="n">argv</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span>
                <span class="n">mode</span><span class="o">=</span><span class="n">DEBUG_LOG</span> <span class="o">+</span> <span class="n">STDOUT_LOG</span><span class="p">,</span>
                <span class="n">func_name</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
            <span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">parse_argv_list</span><span class="p">(</span><span class="n">parent_key</span><span class="p">,</span> <span class="n">sys</span><span class="o">.</span><span class="n">argv</span><span class="p">)</span>

        <span class="c1"># dynamically update valid range and defaults</span>
        <span class="c1"># also can trigger input file parsing based on input flags</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">dynamic_update_user_inputs</span><span class="p">()</span>

        <span class="c1"># validate inputs</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">validate_argv_inputs</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">user_inputs</span><span class="p">)</span>

        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">user_inputs</span></div>


<div class="viewcode-block" id="UserInputs.parse_named_arguments">
<a class="viewcode-back" href="../../docs/thermostatsupervisor.html#thermostatsupervisor.utilities.UserInputs.parse_named_arguments">[docs]</a>
    <span class="k">def</span> <span class="nf">parse_named_arguments</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">parent_key</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">argv_list</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Parse all possible named arguments.</span>

<span class="sd">        inputs:</span>
<span class="sd">            parent_key(str): parent key for dict.</span>
<span class="sd">            argv_list(list): override sys.argv (for testing)</span>
<span class="sd">        returns:</span>
<span class="sd">            (dict) of all runtime parameters.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># set parent key</span>
        <span class="k">if</span> <span class="n">parent_key</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">parent_key</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">default_parent_key</span>

        <span class="c1"># load parser contents</span>
        <span class="k">for</span> <span class="n">_</span><span class="p">,</span> <span class="n">attr</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">user_inputs</span><span class="p">[</span><span class="n">parent_key</span><span class="p">]</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">parser</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span>
                <span class="n">attr</span><span class="p">[</span><span class="s2">&quot;lflag&quot;</span><span class="p">],</span>
                <span class="n">attr</span><span class="p">[</span><span class="s2">&quot;sflag&quot;</span><span class="p">],</span>
                <span class="n">default</span><span class="o">=</span><span class="n">attr</span><span class="p">[</span><span class="s2">&quot;default&quot;</span><span class="p">],</span>
                <span class="nb">type</span><span class="o">=</span><span class="n">attr</span><span class="p">[</span><span class="s2">&quot;type&quot;</span><span class="p">],</span>
                <span class="n">required</span><span class="o">=</span><span class="n">attr</span><span class="p">[</span><span class="s2">&quot;required&quot;</span><span class="p">],</span>
                <span class="n">help</span><span class="o">=</span><span class="n">attr</span><span class="p">[</span><span class="s2">&quot;help&quot;</span><span class="p">],</span>
            <span class="p">)</span>
        <span class="c1"># parse the argument list</span>
        <span class="k">if</span> <span class="n">argv_list</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="c1"># test mode, override sys.argv</span>
            <span class="n">args</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">parser</span><span class="o">.</span><span class="n">parse_args</span><span class="p">(</span><span class="n">argv_list</span><span class="p">[</span><span class="mi">1</span><span class="p">:])</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">args</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">parser</span><span class="o">.</span><span class="n">parse_args</span><span class="p">()</span>
        <span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">user_inputs</span><span class="p">[</span><span class="n">parent_key</span><span class="p">]:</span>
            <span class="k">if</span> <span class="n">key</span> <span class="o">==</span> <span class="s2">&quot;script&quot;</span><span class="p">:</span>
                <span class="c1"># add script name</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">user_inputs</span><span class="p">[</span><span class="n">parent_key</span><span class="p">][</span><span class="n">key</span><span class="p">][</span><span class="s2">&quot;value&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">sys</span><span class="o">.</span><span class="n">argv</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">user_inputs</span><span class="p">[</span><span class="n">parent_key</span><span class="p">][</span><span class="n">key</span><span class="p">][</span><span class="s2">&quot;value&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">args</span><span class="p">,</span> <span class="n">key</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
                <span class="n">strip_types</span> <span class="o">=</span> <span class="nb">str</span>
                <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">user_inputs</span><span class="p">[</span><span class="n">parent_key</span><span class="p">][</span><span class="n">key</span><span class="p">][</span><span class="s2">&quot;value&quot;</span><span class="p">],</span> <span class="n">strip_types</span><span class="p">):</span>
                    <span class="c1"># str parsing has leading spaces for some reason</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">user_inputs</span><span class="p">[</span><span class="n">parent_key</span><span class="p">][</span><span class="n">key</span><span class="p">][</span><span class="s2">&quot;value&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">user_inputs</span><span class="p">[</span>
                        <span class="n">parent_key</span>
                    <span class="p">][</span><span class="n">key</span><span class="p">][</span><span class="s2">&quot;value&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>

        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">user_inputs</span></div>


<div class="viewcode-block" id="UserInputs.parse_argv_list">
<a class="viewcode-back" href="../../docs/thermostatsupervisor.html#thermostatsupervisor.utilities.UserInputs.parse_argv_list">[docs]</a>
    <span class="k">def</span> <span class="nf">parse_argv_list</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">parent_key</span><span class="p">,</span> <span class="n">argv_list</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Parse un-named arguments from list.</span>

<span class="sd">        inputs:</span>
<span class="sd">            parent_key(str): parent key in the user_inputs dict.</span>
<span class="sd">            argv_list(list): list of runtime arguments in the order</span>
<span class="sd">                             argv_list[0] should be script name.</span>
<span class="sd">                             speci5fied in argv_dict &quot;order&quot; fields.</span>
<span class="sd">        returns:</span>
<span class="sd">            (dict) of all runtime parameters.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># set parent key</span>
        <span class="k">if</span> <span class="n">parent_key</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">parent_key</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">default_parent_key</span>

        <span class="c1"># if argv list is set use that, else use sys.argv</span>
        <span class="k">if</span> <span class="n">argv_list</span><span class="p">:</span>
            <span class="n">argv_inputs</span> <span class="o">=</span> <span class="n">argv_list</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">argv_inputs</span> <span class="o">=</span> <span class="n">sys</span><span class="o">.</span><span class="n">argv</span>

        <span class="c1"># populate dict with values from list</span>
        <span class="k">for</span> <span class="n">child_key</span><span class="p">,</span> <span class="n">val</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">user_inputs</span><span class="p">[</span><span class="n">parent_key</span><span class="p">]</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="k">if</span> <span class="n">val</span><span class="p">[</span><span class="s2">&quot;order&quot;</span><span class="p">]</span> <span class="o">&lt;=</span> <span class="nb">len</span><span class="p">(</span><span class="n">argv_inputs</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span><span class="p">:</span>
                <span class="k">if</span> <span class="p">(</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">user_inputs</span><span class="p">[</span><span class="n">parent_key</span><span class="p">][</span><span class="n">child_key</span><span class="p">][</span><span class="s2">&quot;type&quot;</span><span class="p">]</span> <span class="ow">in</span> <span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="nb">float</span><span class="p">,</span> <span class="nb">str</span><span class="p">]</span>
                <span class="p">)</span> <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">is_lambda_bool</span><span class="p">(</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">user_inputs</span><span class="p">[</span><span class="n">parent_key</span><span class="p">][</span><span class="n">child_key</span><span class="p">][</span><span class="s2">&quot;type&quot;</span><span class="p">]</span>
                <span class="p">):</span>
                    <span class="c1"># cast data type when reading value</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">user_inputs</span><span class="p">[</span><span class="n">parent_key</span><span class="p">][</span><span class="n">child_key</span><span class="p">][</span><span class="s2">&quot;value&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">user_inputs</span><span class="p">[</span>
                        <span class="n">parent_key</span>
                    <span class="p">][</span><span class="n">child_key</span><span class="p">][</span><span class="s2">&quot;type&quot;</span><span class="p">](</span><span class="n">argv_inputs</span><span class="p">[</span><span class="n">val</span><span class="p">[</span><span class="s2">&quot;order&quot;</span><span class="p">]])</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="c1"># no casting, just read raw from list</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">user_inputs</span><span class="p">[</span><span class="n">parent_key</span><span class="p">][</span><span class="n">child_key</span><span class="p">][</span><span class="s2">&quot;value&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">argv_inputs</span><span class="p">[</span>
                        <span class="n">val</span><span class="p">[</span><span class="s2">&quot;order&quot;</span><span class="p">]</span>
                    <span class="p">]</span>

        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">user_inputs</span></div>


<div class="viewcode-block" id="UserInputs.is_lambda_bool">
<a class="viewcode-back" href="../../docs/thermostatsupervisor.html#thermostatsupervisor.utilities.UserInputs.is_lambda_bool">[docs]</a>
    <span class="k">def</span> <span class="nf">is_lambda_bool</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">input_type</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Return True if type is a lambda function.</span>

<span class="sd">        inputs:</span>
<span class="sd">            input_type(type): input type</span>
<span class="sd">        returns:</span>
<span class="sd">            (bool): True for lambda type</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># cast to string if necessary</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">input_type</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
            <span class="n">input_type</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">input_type</span><span class="p">)</span>

        <span class="c1"># eval</span>
        <span class="k">return</span> <span class="kc">True</span> <span class="k">if</span> <span class="s2">&quot;lambda&quot;</span> <span class="ow">in</span> <span class="n">input_type</span> <span class="k">else</span> <span class="kc">False</span></div>


<div class="viewcode-block" id="UserInputs.dynamic_update_user_inputs">
<a class="viewcode-back" href="../../docs/thermostatsupervisor.html#thermostatsupervisor.utilities.UserInputs.dynamic_update_user_inputs">[docs]</a>
    <span class="k">def</span> <span class="nf">dynamic_update_user_inputs</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Update user_inputs dict dynamically based on runtime parameters.&quot;&quot;&quot;</span>
        <span class="k">pass</span>  <span class="c1"># placeholder</span></div>


<div class="viewcode-block" id="UserInputs.validate_argv_inputs">
<a class="viewcode-back" href="../../docs/thermostatsupervisor.html#thermostatsupervisor.utilities.UserInputs.validate_argv_inputs">[docs]</a>
    <span class="k">def</span> <span class="nf">validate_argv_inputs</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">argv_dict</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Validate argv inputs and update reset to defaults if necessary.</span>

<span class="sd">        inputs:</span>
<span class="sd">            argv_dict(dict): dictionary of runtime args with these elements:</span>
<span class="sd">            &lt;parent_key&gt;: {</span>
<span class="sd">            &lt;key&gt;: {  # key = argument name</span>
<span class="sd">                &quot;order&quot;: 0,  # order in the argv list</span>
<span class="sd">                &quot;value&quot;: None,   # initialized to None</span>
<span class="sd">                &quot;type&quot;: str,  # datatype</span>
<span class="sd">                &quot;default&quot;: &quot;supervise.py&quot;,  # default value</span>
<span class="sd">                &quot;sflag&quot;: &quot;-s&quot;,  # short flag identifier</span>
<span class="sd">                &quot;lflag&quot;: &quot;--script&quot;,  # long flag identifier</span>
<span class="sd">                &quot;help&quot;: &quot;script name&quot;},  # help text</span>
<span class="sd">                &quot;valid&quot;: None,  # valid choices</span>
<span class="sd">                &quot;required&quot;: True,  # is parameter required?</span>
<span class="sd">            }}</span>
<span class="sd">        returns:</span>
<span class="sd">            (dict) of all runtime parameters, only needed for testing.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">for</span> <span class="n">parent_key</span><span class="p">,</span> <span class="n">child_dict</span> <span class="ow">in</span> <span class="n">argv_dict</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="k">for</span> <span class="n">child_key</span><span class="p">,</span> <span class="n">attr</span> <span class="ow">in</span> <span class="n">child_dict</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
                <span class="n">proposed_value</span> <span class="o">=</span> <span class="n">attr</span><span class="p">[</span><span class="s2">&quot;value&quot;</span><span class="p">]</span>
                <span class="n">default_value</span> <span class="o">=</span> <span class="n">attr</span><span class="p">[</span><span class="s2">&quot;default&quot;</span><span class="p">]</span>
                <span class="n">proposed_type</span> <span class="o">=</span> <span class="nb">type</span><span class="p">(</span><span class="n">proposed_value</span><span class="p">)</span>
                <span class="c1"># expected type lambda cast to bool</span>
                <span class="c1"># should never get bool for attr[&quot;type&quot;]</span>
                <span class="k">if</span> <span class="n">attr</span><span class="p">[</span><span class="s2">&quot;type&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="nb">bool</span><span class="p">:</span>
                    <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span>
                        <span class="s2">&quot;CODING ERROR: UserInput bool &quot;</span>
                        <span class="s2">&quot;typedefs don&#39;t work, use a lambda &quot;</span>
                        <span class="s2">&quot;function&quot;</span>
                    <span class="p">)</span>
                <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">is_lambda_bool</span><span class="p">(</span><span class="n">attr</span><span class="p">[</span><span class="s2">&quot;type&quot;</span><span class="p">]):</span>
                    <span class="n">expected_type</span> <span class="o">=</span> <span class="nb">bool</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">expected_type</span> <span class="o">=</span> <span class="n">attr</span><span class="p">[</span><span class="s2">&quot;type&quot;</span><span class="p">]</span>
                <span class="c1"># missing value check</span>
                <span class="k">if</span> <span class="n">proposed_value</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                    <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">suppress_warnings</span><span class="p">:</span>
                        <span class="n">log_msg</span><span class="p">(</span>
                            <span class="sa">f</span><span class="s2">&quot;parent_key=</span><span class="si">{</span><span class="n">parent_key</span><span class="si">}</span><span class="s2">, child_key=&#39;</span><span class="si">{</span><span class="n">child_key</span><span class="si">}</span><span class="s2">&#39;&quot;</span>
                            <span class="sa">f</span><span class="s2">&quot;: argv parameter missing, using default &quot;</span>
                            <span class="sa">f</span><span class="s2">&quot;value &#39;</span><span class="si">{</span><span class="n">default_value</span><span class="si">}</span><span class="s2">&#39;&quot;</span><span class="p">,</span>
                            <span class="n">mode</span><span class="o">=</span><span class="n">DEBUG_LOG</span> <span class="o">+</span> <span class="n">STDOUT_LOG</span><span class="p">,</span>
                            <span class="n">func_name</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
                        <span class="p">)</span>
                    <span class="n">attr</span><span class="p">[</span><span class="s2">&quot;value&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">attr</span><span class="p">[</span><span class="s2">&quot;default&quot;</span><span class="p">]</span>

                <span class="c1"># wrong datatype check</span>
                <span class="k">elif</span> <span class="n">proposed_type</span> <span class="o">!=</span> <span class="n">expected_type</span><span class="p">:</span>
                    <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">suppress_warnings</span><span class="p">:</span>
                        <span class="n">log_msg</span><span class="p">(</span>
                            <span class="sa">f</span><span class="s2">&quot;parent_key=</span><span class="si">{</span><span class="n">parent_key</span><span class="si">}</span><span class="s2">, child_key=&#39;</span><span class="si">{</span><span class="n">child_key</span><span class="si">}</span><span class="s2">&#39;&quot;</span>
                            <span class="sa">f</span><span class="s2">&quot;: datatype error, expected=&quot;</span>
                            <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">expected_type</span><span class="si">}</span><span class="s2">, actual=</span><span class="si">{</span><span class="n">proposed_type</span><span class="si">}</span><span class="s2">, &quot;</span>
                            <span class="s2">&quot;using default value &quot;</span>
                            <span class="sa">f</span><span class="s2">&quot;&#39;</span><span class="si">{</span><span class="n">default_value</span><span class="si">}</span><span class="s2">&#39;&quot;</span><span class="p">,</span>
                            <span class="n">mode</span><span class="o">=</span><span class="n">DEBUG_LOG</span> <span class="o">+</span> <span class="n">STDOUT_LOG</span><span class="p">,</span>
                            <span class="n">func_name</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
                        <span class="p">)</span>
                    <span class="n">attr</span><span class="p">[</span><span class="s2">&quot;value&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">attr</span><span class="p">[</span><span class="s2">&quot;default&quot;</span><span class="p">]</span>

                <span class="c1"># out of range check</span>
                <span class="k">elif</span> <span class="p">(</span>
                    <span class="n">attr</span><span class="p">[</span><span class="s2">&quot;valid_range&quot;</span><span class="p">]</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span>
                    <span class="ow">and</span> <span class="n">proposed_value</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">attr</span><span class="p">[</span><span class="s2">&quot;valid_range&quot;</span><span class="p">]</span>
                <span class="p">):</span>
                    <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">suppress_warnings</span><span class="p">:</span>
                        <span class="n">log_msg</span><span class="p">(</span>
                            <span class="sa">f</span><span class="s2">&quot;WARNING: &#39;</span><span class="si">{</span><span class="n">proposed_value</span><span class="si">}</span><span class="s2">&#39; is not a valid &quot;</span>
                            <span class="sa">f</span><span class="s2">&quot;choice parent_key=&#39;</span><span class="si">{</span><span class="n">parent_key</span><span class="si">}</span><span class="s2">&#39;, child_key=&quot;</span>
                            <span class="sa">f</span><span class="s2">&quot;&#39;</span><span class="si">{</span><span class="n">child_key</span><span class="si">}</span><span class="s2">&#39;, using default &#39;</span><span class="si">{</span><span class="n">default_value</span><span class="si">}</span><span class="s2">&#39;&quot;</span><span class="p">,</span>
                            <span class="n">mode</span><span class="o">=</span><span class="n">BOTH_LOG</span><span class="p">,</span>
                            <span class="n">func_name</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
                        <span class="p">)</span>
                    <span class="n">attr</span><span class="p">[</span><span class="s2">&quot;value&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">attr</span><span class="p">[</span><span class="s2">&quot;default&quot;</span><span class="p">]</span>

        <span class="k">return</span> <span class="n">argv_dict</span></div>


<div class="viewcode-block" id="UserInputs.get_user_inputs">
<a class="viewcode-back" href="../../docs/thermostatsupervisor.html#thermostatsupervisor.utilities.UserInputs.get_user_inputs">[docs]</a>
    <span class="k">def</span> <span class="nf">get_user_inputs</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">parent_key</span><span class="p">,</span> <span class="n">child_key</span><span class="p">,</span> <span class="n">field</span><span class="o">=</span><span class="s2">&quot;value&quot;</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Return the target key&#39;s value from user_inputs.</span>

<span class="sd">        inputs:</span>
<span class="sd">            parent_key(str): top-level key</span>
<span class="sd">            child_key(str): second-level key</span>
<span class="sd">            field(str): field name, default = &quot;value&quot;</span>
<span class="sd">        returns:</span>
<span class="sd">            None</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">child_key</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">user_inputs</span><span class="p">[</span><span class="n">parent_key</span><span class="p">][</span><span class="n">field</span><span class="p">]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">user_inputs</span><span class="p">[</span><span class="n">parent_key</span><span class="p">][</span><span class="n">child_key</span><span class="p">][</span><span class="n">field</span><span class="p">]</span>
            <span class="k">except</span> <span class="ne">TypeError</span><span class="p">:</span>
                <span class="nb">print</span><span class="p">(</span>
                    <span class="sa">f</span><span class="s2">&quot;TypeError: parent_key(</span><span class="si">{</span><span class="nb">type</span><span class="p">(</span><span class="n">parent_key</span><span class="p">)</span><span class="si">}</span><span class="s2">)=</span><span class="si">{</span><span class="n">parent_key</span><span class="si">}</span><span class="s2">&quot;</span>
                    <span class="sa">f</span><span class="s2">&quot;, child_key(</span><span class="si">{</span><span class="nb">type</span><span class="p">(</span><span class="n">child_key</span><span class="p">)</span><span class="si">}</span><span class="s2">)=</span><span class="si">{</span><span class="n">child_key</span><span class="si">}</span><span class="s2">, &quot;</span>
                    <span class="sa">f</span><span class="s2">&quot;field(</span><span class="si">{</span><span class="nb">type</span><span class="p">(</span><span class="n">field</span><span class="p">)</span><span class="si">}</span><span class="s2">)=</span><span class="si">{</span><span class="n">field</span><span class="si">}</span><span class="s2">)&quot;</span>
                <span class="p">)</span>
                <span class="k">raise</span>
            <span class="k">except</span> <span class="ne">KeyError</span><span class="p">:</span>
                <span class="nb">print</span><span class="p">(</span>
                    <span class="sa">f</span><span class="s2">&quot;KeyError: target=[</span><span class="si">{</span><span class="n">parent_key</span><span class="si">}</span><span class="s2">][</span><span class="si">{</span><span class="n">child_key</span><span class="si">}</span><span class="s2">][</span><span class="si">{</span><span class="n">field</span><span class="si">}</span><span class="s2">],&quot;</span>
                    <span class="sa">f</span><span class="s2">&quot; raw=</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">user_inputs</span><span class="o">.</span><span class="n">keys</span><span class="p">()</span><span class="si">}</span><span class="s2">&quot;</span>
                <span class="p">)</span>
                <span class="k">raise</span></div>


<div class="viewcode-block" id="UserInputs.set_user_inputs">
<a class="viewcode-back" href="../../docs/thermostatsupervisor.html#thermostatsupervisor.utilities.UserInputs.set_user_inputs">[docs]</a>
    <span class="k">def</span> <span class="nf">set_user_inputs</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">parent_key</span><span class="p">,</span> <span class="n">child_key</span><span class="p">,</span> <span class="n">input_val</span><span class="p">,</span> <span class="n">field</span><span class="o">=</span><span class="s2">&quot;value&quot;</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Set the target key&#39;s value from user_inputs.</span>

<span class="sd">        inputs:</span>
<span class="sd">            parent_key(str): top-level key</span>
<span class="sd">            child_key(str): second-level key</span>
<span class="sd">            input_val(str, int, float, etc.):  value to set.</span>
<span class="sd">            field(str): field name, default = &quot;value&quot;</span>
<span class="sd">        returns:</span>
<span class="sd">            None, updates uip.user_inputs dict.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">child_key</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">user_inputs</span><span class="p">[</span><span class="n">parent_key</span><span class="p">][</span><span class="n">field</span><span class="p">]</span> <span class="o">=</span> <span class="n">input_val</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">user_inputs</span><span class="p">[</span><span class="n">parent_key</span><span class="p">][</span><span class="n">child_key</span><span class="p">][</span><span class="n">field</span><span class="p">]</span> <span class="o">=</span> <span class="n">input_val</span>
            <span class="k">except</span> <span class="ne">TypeError</span><span class="p">:</span>
                <span class="nb">print</span><span class="p">(</span>
                    <span class="sa">f</span><span class="s2">&quot;TypeError: keys=</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">user_inputs</span><span class="o">.</span><span class="n">keys</span><span class="p">()</span><span class="si">}</span><span class="s2"> &quot;</span>
                    <span class="sa">f</span><span class="s2">&quot;(type=</span><span class="si">{</span><span class="nb">type</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">user_inputs</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span><span class="si">}</span><span class="s2">)&quot;</span>
                <span class="p">)</span>
                <span class="k">raise</span>
            <span class="k">except</span> <span class="ne">KeyError</span><span class="p">:</span>
                <span class="nb">print</span><span class="p">(</span>
                    <span class="sa">f</span><span class="s2">&quot;KeyError: target=[</span><span class="si">{</span><span class="n">parent_key</span><span class="si">}</span><span class="s2">][</span><span class="si">{</span><span class="n">child_key</span><span class="si">}</span><span class="s2">][</span><span class="si">{</span><span class="n">field</span><span class="si">}</span><span class="s2">],&quot;</span>
                    <span class="sa">f</span><span class="s2">&quot; raw=</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">user_inputs</span><span class="o">.</span><span class="n">keys</span><span class="p">()</span><span class="si">}</span><span class="s2">&quot;</span>
                <span class="p">)</span>
                <span class="k">raise</span></div>


<div class="viewcode-block" id="UserInputs.is_valid_file">
<a class="viewcode-back" href="../../docs/thermostatsupervisor.html#thermostatsupervisor.utilities.UserInputs.is_valid_file">[docs]</a>
    <span class="k">def</span> <span class="nf">is_valid_file</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">arg</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Verify file input is valid.</span>

<span class="sd">        inputs:</span>
<span class="sd">            arg(str): file name with path.</span>
<span class="sd">        returns:</span>
<span class="sd">            open file handle</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">arg</span> <span class="o">=</span> <span class="n">arg</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>  <span class="c1"># remove any leading spaces</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">arg</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">parser</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;The file </span><span class="si">{</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">abspath</span><span class="p">(</span><span class="n">arg</span><span class="p">)</span><span class="si">}</span><span class="s2"> does not exist!&quot;</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="nb">open</span><span class="p">(</span><span class="n">arg</span><span class="p">,</span> <span class="s2">&quot;r&quot;</span><span class="p">,</span> <span class="n">encoding</span><span class="o">=</span><span class="s2">&quot;utf8&quot;</span><span class="p">)</span>  <span class="c1"># return a file handle</span></div>


<div class="viewcode-block" id="UserInputs.parse_input_file">
<a class="viewcode-back" href="../../docs/thermostatsupervisor.html#thermostatsupervisor.utilities.UserInputs.parse_input_file">[docs]</a>
    <span class="k">def</span> <span class="nf">parse_input_file</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">input_file</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Parse an input file into a dict.</span>

<span class="sd">        Primary key is the section.</span>
<span class="sd">        Secondary key is the parameter.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">input_file</span> <span class="o">=</span> <span class="n">input_file</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>  <span class="c1"># strip any whitespace</span>
        <span class="n">config</span> <span class="o">=</span> <span class="n">configparser</span><span class="o">.</span><span class="n">ConfigParser</span><span class="p">()</span>
        <span class="n">result</span> <span class="o">=</span> <span class="n">config</span><span class="o">.</span><span class="n">read</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">getcwd</span><span class="p">(),</span> <span class="n">input_file</span><span class="p">))</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">result</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">FileNotFoundError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;file &#39;</span><span class="si">{</span><span class="n">input_file</span><span class="si">}</span><span class="s2">&#39; was not found&quot;</span><span class="p">)</span>
        <span class="n">sections</span> <span class="o">=</span> <span class="n">config</span><span class="o">.</span><span class="n">sections</span><span class="p">()</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">sections</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;INI file must have sections&quot;</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">section</span> <span class="ow">in</span> <span class="n">sections</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">user_inputs_file</span><span class="p">[</span><span class="n">section</span><span class="p">]</span> <span class="o">=</span> <span class="p">{}</span>
            <span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="n">config</span><span class="p">[</span><span class="n">section</span><span class="p">]:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">user_inputs_file</span><span class="p">[</span><span class="n">section</span><span class="p">][</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="n">config</span><span class="p">[</span><span class="n">section</span><span class="p">][</span><span class="n">key</span><span class="p">]</span></div>
</div>

</pre></div>

          </div>
          
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="Main">
        <div class="sphinxsidebarwrapper">
<h1 class="logo"><a href="../../index.html">ThermostatSupervisor</a></h1>









<search id="searchbox" style="display: none" role="search">
    <div class="searchformwrapper">
    <form class="search" action="../../search.html" method="get">
      <input type="text" name="q" aria-labelledby="searchlabel" autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" placeholder="Search"/>
      <input type="submit" value="Go" />
    </form>
    </div>
</search>
<script>document.getElementById('searchbox').style.display = "block"</script><h3>Navigation</h3>

<div class="relations">
<h3>Related Topics</h3>
<ul>
  <li><a href="../../index.html">Documentation overview</a><ul>
  <li><a href="../index.html">Module code</a><ul>
  </ul></li>
  </ul></li>
</ul>
</div>








        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="footer">
      &#169;2024, Christopher Krolak.
      
      |
      Powered by <a href="https://www.sphinx-doc.org/">Sphinx 8.1.3</a>
      &amp; <a href="https://alabaster.readthedocs.io">Alabaster 1.0.0</a>
      
    </div>

    

    
  </body>
</html>